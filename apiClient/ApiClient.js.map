{"version":3,"sources":["../src/apiClient/ApiClient.js"],"names":["cookie","__SERVER__","methods","getProtocol","req","formatUrl","path","config","test","adjustedPath","protocol","apiPort","apiHost","ApiClient","res","operating","forEach","method","params","data","noLogin","jsonFlag","shopFlag","companyIdFlag","resolve","reject","url","request","console","log","userAgent","headers","set","companyId","cookies","session","undefined","shopId","get","_","Date","query","type","send","sso","body","ssoSystem","service","redirectUrl","code","urls","replace","split","length","splice","unshift","join","fullUrl","originalUrl","redirect","encodeURIComponent","e","hostMatch","window","location","href","match","redirectUrls","error","err","end","response","text"],"mappings":"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","file":"ApiClient.js","sourcesContent":["import superagent from 'superagent';\r\nimport Cookies from '../common/Cookies';\r\nlet cookie = '';\r\nif (!__SERVER__) {\r\n  cookie = new Cookies();\r\n}\r\nconst methods = ['get', 'post', 'put', 'patch', 'del'];\r\nfunction getProtocol(req) {\r\n  return \"http:\";\r\n  //return req.headers[\"x-proto\"]==\"http\"?\"http:\":\"https:\";\r\n}\r\nfunction formatUrl(path, config, req) {\r\n  if (/^(https?:)|^(\\/\\/)/.test(path)) return path;\r\n  const adjustedPath = path[0] !== '/' ? '/' + path : path;\r\n  if (__SERVER__) {\r\n    var protocol = getProtocol(req);\r\n    //var protocol = req.headers[\"x-proto\"]==\"http\"?\"http\":\"https\";\r\n    if (config.apiPort != \"\" && config.apiPort != \"80\") {\r\n      return protocol + '//' + config.apiHost + ':' + config.apiPort + adjustedPath;\r\n    } else {\r\n      return protocol + '//' + config.apiHost + adjustedPath;\r\n    }\r\n    // Prepend host and port of the API server to the path.\r\n  }\r\n  // Prepend `/api` to relative URL, to proxy to API server.\r\n  return '/proxy' + adjustedPath;\r\n}\r\n\r\nexport default class ApiClient {\r\n  constructor(config, req, res, operating) {\r\n    methods.forEach((method) =>\r\n      this[method] = (path, {params, data} = {}, noLogin, jsonFlag, shopFlag, companyIdFlag) => new Promise((resolve, reject) => {\r\n        var url = formatUrl(path, config, req);\r\n        const request = superagent[method](url);\r\n        console.log(__SERVER__ ? \"Server\" : \"Client\", \"---ajax:\", url);\r\n        params = params || {};\r\n\r\n        /*\r\n         * node端判断companyId\r\n         * */\r\n        if (__SERVER__) {\r\n\r\n          var userAgent = req.headers['user-agent'];\r\n          request.set(\"user-agent\", userAgent);\r\n          \r\n          // 判断params中是否存在companyId，如果不存在则添加\r\n          if (!params.companyId) {\r\n            // 如果cookie里不存在companyId，读取session里的companyId,否则从cookie读取\r\n            if (!req.cookies['companyId']) {\r\n              params.companyId = req.session && req.session.companyId || undefined;\r\n            } else {\r\n              params.companyId = req.cookies['companyId'];\r\n            }\r\n          }\r\n        }\r\n        if (!__SERVER__ && !data) {\r\n          /*\r\n           * 获取cookie中的shopId，通过为空判断，将shopId添加到params对象中\r\n           * 实现为每个请求添加shopId参数\r\n           * */\r\n          if (!shopFlag && !params.shopId) {\r\n            params.shopId = cookie.get('shopId');\r\n          }\r\n          /*\r\n           * 获取cookie中的companyId，通过为空判断，将companyId添加到params对象中\r\n           * 实现为每个请求添加companyId参数\r\n           * */\r\n          if (!companyIdFlag && !params.companyId) {\r\n            params.companyId = cookie.get('companyId');\r\n          }\r\n        }\r\n\r\n        params._ = +new Date();\r\n        request.query(params);\r\n\r\n        if (__SERVER__ && req.get('cookie')) {\r\n          request.set('cookie', req.get('cookie'));\r\n        }\r\n        if (__SERVER__) {\r\n          request.set('original-host', req.get(\"host\"));\r\n          console.log(\"host:---------------->\", request.get(\"original-host\"));\r\n\r\n          // // 根据店铺用户权限，跳转到查询出的菜单第1个链接\r\n          // const _params = {};\r\n          // const menuUrl = '/proxy/authority-service/mall/resource/queryResourceMenuBySellerId';\r\n          // const request1 = superagent[method](menuUrl);\r\n          // request1.set('original-host', req.get('host'));\r\n          // request1.set('cookie', req.get('cookie'));\r\n          // _params.shopType = req.cookies['shopType'];\r\n          // _params.shopId = req.cookies['shopId'];\r\n          // _params.companyId = req.cookies['companyId'];\r\n          // _params._ = +new Date();\r\n          // request1.query(_params);\r\n          // request1.end((err, response) => {\r\n          //   if (response.body.code == 0) {\r\n          //     // 从返回的数据中截取第1个有效url做为跳转路径\r\n          //     const _data = JSON.stringify(response.body.data);\r\n          //     const urlArr1 = _data.substr(_data.indexOf('\"url\":\"/') + 7);\r\n          //     const urlArr2 = urlArr1.substr(0, urlArr1.indexOf('\"'));\r\n          //     // 如果当前url中含有shop(即认为是在店铺页面下)，则重定向url到第1个有并向路径\r\n          //     if (req.headers.host.indexOf('shop.') >= 0) {\r\n          //       req.redirect(302, '//' + req.headers.host + urlArr2);\r\n          //     }\r\n          //   }\r\n          // });\r\n        }\r\n        if (data) {\r\n          /*\r\n           * node端判断companyId\r\n           * */\r\n          if (__SERVER__) {\r\n            // 判断params中是否存在companyId，如果不存在则添加\r\n            if (typeof data === 'object') {\r\n              if (!data.companyId) {\r\n                if (!req.cookies['companyId']) {\r\n                  data.companyId = req.session && req.session.companyId || undefined;\r\n                } else {\r\n                  data.companyId = req.cookies['companyId'];\r\n                }\r\n              }\r\n            }\r\n          }\r\n          if (!__SERVER__) {\r\n            if (typeof data === 'object') {\r\n              /*\r\n               * 获取cookie中的shopId，通过为空判断，将shopId添加到params对象中\r\n               * 实现为每个请求添加shopId参数\r\n               * */\r\n              if (!shopFlag && !data.shopId) {\r\n                data.shopId = cookie.get('shopId');\r\n              }\r\n              /*\r\n               * 获取cookie中的companyId，通过为空判断，将companyId添加到params对象中\r\n               * 实现为每个请求添加companyId参数\r\n               * */\r\n              if (!companyIdFlag && !data.companyId) {\r\n                data.companyId = cookie.get('companyId');\r\n              }\r\n            }\r\n          }\r\n          if (jsonFlag) {\r\n            request.type(\"json\").send(data);\r\n          } else {\r\n            request.type(\"form\").send(data);\r\n          }\r\n\r\n        }\r\n        function sso(body) {\r\n          const ssoSystem = operating ? \"passport-platform\" : \"passport\";\r\n          const service = operating ? \"passport-operating-view\" : \"service-passport-view\";\r\n          let redirectUrl = `//@/${service}/determine/login?return_url=`;\r\n          if (noLogin) {\r\n            resolve(body)\r\n          } else {\r\n            if (__SERVER__ && body.code == \"0-0004\") {\r\n              var urls = req.get('host').replace(\"www.\", \"\").split(\".\");\r\n              if (urls.length > 2) {\r\n                if (urls[0] == \"mall\" || urls[0] == \"shop\" || urls[0] == \"buyer\" || urls[0] == \"passport\" || urls[0] == \"platform\" || urls[0] == \"passport-platform\" || urls[0] == \"view-zone\"\r\n                ) {\r\n                  urls.splice(0, 1, ssoSystem);\r\n                } else {\r\n                  urls.unshift(ssoSystem);\r\n                }\r\n              } else {\r\n                urls.unshift(ssoSystem)\r\n              }\r\n              var protocol = getProtocol(req);\r\n              redirectUrl = protocol + redirectUrl.replace(\"@\", urls.join(\".\"));\r\n              try {\r\n                var fullUrl = protocol + '//' + req.get('host') + req.originalUrl;\r\n                res && res.redirect(redirectUrl + encodeURIComponent(fullUrl));\r\n              } catch (e) {\r\n              }\r\n            } else if (body.code == \"0-0004\") {\r\n              let hostMatch = window.location.href.replace(\"www.\", \"\").match(/.*?\\/\\/(.*?)\\/|.*?\\/\\/(.*)/);\r\n              let urls = hostMatch[1] || hostMatch[2];\r\n              urls = urls.split(\".\");\r\n              if (urls.length > 2) {\r\n                if (urls[0] == \"mall\" || urls[0] == \"shop\" || urls[0] == \"buyer\" || urls[0] == \"passport\" || urls[0] == \"platform\" || urls[0] == \"passport-platform\" || urls[0] == \"view-zone\"\r\n                ) {\r\n                  urls.splice(0, 1, ssoSystem);\r\n                } else {\r\n                  urls.unshift(ssoSystem);\r\n                }\r\n              } else {\r\n                urls.unshift(ssoSystem);\r\n              }\r\n              redirectUrl = redirectUrl.replace(\"@\", urls.join(\".\"));\r\n              window.location.href = redirectUrl + encodeURIComponent(window.location.href);\r\n            } else if (!!!__SERVER__ && body.code == \"000001020001\") {\r\n              let hostMatch = window.location.href.match(/.*?\\/\\/(.*?)\\/|.*?\\/\\/(.*)/);\r\n              let urls = hostMatch[1] || hostMatch[2]\r\n              // console.log(\"hostMatch\")\r\n              //  console.log(hostMatch)\r\n              // console.log(\"hostMatch\")\r\n              // console.log(\"2222222222\")\r\n              let redirectUrls = \"/user-shop-view/sellerinfo/defaultsupplyhome\";\r\n              window.location.href = '//' + urls + redirectUrls\r\n            } else {\r\n              resolve(body);\r\n            }\r\n          }\r\n        }\r\n\r\n        function error(err) {\r\n          reject(err)\r\n        }\r\n\r\n        //request.end((err, { body , text }) => err ? error(body||err) : sso(JSON.stringify(body)==\"{}\"?text:body));\r\n        request.end(function (err, response) {\r\n          try {\r\n            if (response) {\r\n              response = response || {};\r\n              var body = response.body || {}, text = response.text || \"\";\r\n              err ? error(body || err) : sso(JSON.stringify(body) == \"{}\" ? text : body);\r\n            } else {\r\n              __SERVER__ && res.send(\"请求后端接口：\" + url + \"，请求参数:\" + JSON.stringify(params) + \",返回异常\" + err + \",response:\" + response)\r\n            }\r\n          } catch (e) {\r\n            __SERVER__ && res.send(\"请求后端接口：\" + url + \"，请求参数:\" + JSON.stringify(params) + \",返回异常\" + err + \",response:\" + response)\r\n          }\r\n\r\n        });\r\n\r\n\r\n      }));\r\n  }\r\n\r\n  /*\r\n   * There's a V8 bug where, when using Babel, exporting classes with only\r\n   * constructors sometimes fails. Until it's patched, this is a solution to\r\n   * \"ApiClient is not defined\" from issue #14.\r\n   * https://github.com/erikras/react-redux-universal-hot-example/issues/14\r\n   *\r\n   * Relevant Babel bug (but they claim it's V8): https://phabricator.babeljs.io/T2455\r\n   *\r\n   * Remove it at your own risk.\r\n   */\r\n  empty() {\r\n  }\r\n}\r\n"]}