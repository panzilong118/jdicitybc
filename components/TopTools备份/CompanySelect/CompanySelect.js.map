{"version":3,"sources":["..\\..\\..\\src\\components\\TopTools备份\\CompanySelect\\CompanySelect.js"],"names":["cookie","Cookies","CompanySelect","getCompanyList","getCompanyListAction","dispatch","props","state","options","selectedTitle","then","rs","code","data","length","companyIdCookie","get","renderOptions","location","href","buyerDomain","setState","msg","companyId","set","doma","reload","indexOf","window","isCompanyIdInCookie","map","_item","companyName","push","onSelectChange","Component"],"mappings":"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","file":"CompanySelect.js","sourcesContent":["/*\r\n * @author:      冯炎\r\n * @update:      20171201\r\n * @description: 采购商中心页面\r\n * */\r\n\r\n/* ***********  基础组件  ************ */\r\nimport React, {Component} from 'react';\r\nimport {Icon} from 'jdcloudui';\r\nimport {bindActionCreators} from 'redux';\r\nimport {connect} from 'react-redux';\r\n\r\n/* ***********  自定义组件  ************ */\r\nimport './style/style.css';\r\nimport getCompanyList, {getCompanyListAction} from './redux/companyList_redux';\r\nimport Cookies from '../../../common/Cookies';\r\nconst cookie = new Cookies();\r\n\r\n@connect(\r\n  state => (getCompanyList),\r\n  dispatch => bindActionCreators({getCompanyListAction}, dispatch)\r\n)\r\nexport default class CompanySelect extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      options: [],\r\n      selectedTitle: '请选择您要访问的公司',\r\n    };\r\n  }\r\n\r\n  componentWillMount() {\r\n    this.props.getCompanyListAction().then(rs => {\r\n      if (rs.code == 0) {\r\n        if (rs.data && rs.data.length > 0) {\r\n          // 设置cookie\r\n          this.companyIdCookie = cookie.get('companyId');\r\n          // 根据接口返回数据渲染下拉列表\r\n          this.renderOptions(rs.data);\r\n        } else {\r\n          // 如果访问接口没有数据则跳转到添加公司引导页\r\n          location.href = `//${this.props.buyerDomain}/user-buyer-view/accountmanage/addcompany?type=1`;\r\n        }\r\n      } else {\r\n        this.setState({selectedTitle: rs.msg});\r\n      }\r\n    });\r\n  }\r\n\r\n  /*\r\n   * 下拉列表触发事件\r\n   * */\r\n\r\n  onSelectChange({companyId}) {\r\n    // 设置cookie\r\n    cookie.set('companyId', companyId, '', this.props.doma);\r\n    location.reload();  // 刷新当前页面\r\n  }\r\n\r\n  /*\r\n   * 判断cookie是否有companyId\r\n   * */\r\n  isCompanyIdInCookie(data) {\r\n    // 如果cookie里有companyId，但当前登陆账号里没相同的companyId则将当前账号下的第1个companyId设置到cookie里\r\n    // 刷新当前页面，重新发送带有新companyId的ajax请求\r\n    if (this.companyIdCookie && JSON.stringify(data).indexOf(this.companyIdCookie) === -1 || !this.companyIdCookie) {\r\n      cookie.set('companyId', data[0].companyId, '', this.props.doma);\r\n      window.location.reload();  // 刷新当前页面\r\n    }\r\n  }\r\n\r\n  /*\r\n   * 渲染公司下拉列表\r\n   * */\r\n  renderOptions(data) {\r\n    const options = [];\r\n    // 判断cookie中是否存在companyId\r\n    this.isCompanyIdInCookie(data);\r\n    data.map(_item => {\r\n      // 如果有cookie里有companyId则将店铺列表里与companyId相同的数据设置为默认\r\n      if (this.companyIdCookie && _item.companyId == this.companyIdCookie) {\r\n        this.setState({selectedTitle: _item.companyName});\r\n      }\r\n      // 生成店铺下拉列表\r\n      options.push(\r\n        <li title={_item.companyName} className={this.companyIdCookie == _item.companyId && 'active'}\r\n            key={_item.companyId}>\r\n          <a\r\n            href=\"javascript:void(0)\"\r\n            onClick={() => this.onSelectChange({companyId: _item.companyId})}\r\n          >\r\n            {_item.companyName}\r\n          </a>\r\n        </li>\r\n      );\r\n    });\r\n    this.setState({options: options});\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"downMenu company\">\r\n        <a>\r\n          <p className=\"f-pre\" title={this.state.selectedTitle}>{this.state.selectedTitle}</p>\r\n          <Icon type=\"down ml5\" className=\"trans180\"/>\r\n        </a>\r\n        {this.state.options.length > 0 && (\r\n          <ul>\r\n            {this.state.options}\r\n          </ul>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}"]}