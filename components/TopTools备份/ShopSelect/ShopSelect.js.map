{"version":3,"sources":["..\\..\\..\\src\\components\\TopTools备份\\ShopSelect\\ShopSelect.js"],"names":["cookie","Cookies","CompanySelect","getShopList","getShopListAction","dispatch","props","state","options","selectedTitle","then","rs","code","data","length","shopId","get","renderOptions","location","href","shopDomain","setState","msg","companyId","shopType","set","doma","indexOf","isCompanyIdInCookie","map","_item","companyName","shopName","push","onSelectChange","Component"],"mappings":"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","file":"ShopSelect.js","sourcesContent":["/*\r\n * @author:      冯炎\r\n * @update:      20171213\r\n * @description: 卖家(第三方商家+自营供应商)中心所有的页面\r\n * */\r\n\r\n/* ***********  基础组件  ************ */\r\nimport React, {Component} from 'react';\r\nimport {Icon} from 'jdcloudui';\r\nimport {bindActionCreators} from 'redux';\r\nimport {connect} from 'react-redux';\r\n\r\n/* ***********  自定义组件  ************ */\r\nimport './style/style.css';\r\nimport getShopList, {getShopListAction} from './redux/shopList_redux';\r\nimport Cookies from '../../../common/Cookies';\r\nconst cookie = new Cookies();\r\n\r\n@connect(\r\n  state => (getShopList),\r\n  dispatch => bindActionCreators({getShopListAction}, dispatch)\r\n)\r\nexport default class CompanySelect extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      options: [],\r\n      selectedTitle: '请选择您要访问的店铺',\r\n    };\r\n  }\r\n\r\n  componentWillMount() {\r\n    this.props.getShopListAction().then(rs => {\r\n      if (rs.code == 0) {\r\n        if (rs.data && rs.data.length > 0) {\r\n          // 设置cookie\r\n          this.shopId = cookie.get('shopId');\r\n          // 根据接口返回数据渲染下拉列表\r\n          this.renderOptions(rs.data);\r\n        } else {\r\n          // 如果访问接口没有数据则跳转到入驻引导页\r\n          location.href = `//${this.props.shopDomain}/user-shop-view/sellerinfo/defaultshophome`;\r\n        }\r\n      } else {\r\n        this.setState({selectedTitle: rs.msg});\r\n      }\r\n    });\r\n  }\r\n\r\n  /*\r\n   * 下拉列表触发事件\r\n   * */\r\n\r\n  onSelectChange({shopId, companyId, shopType}) {\r\n    // 设置cookie\r\n    cookie.set('shopId', shopId, '', this.props.doma);\r\n    cookie.set('companyId', companyId, '', this.props.doma);\r\n    cookie.set('shopType', shopType, '', this.props.doma);\r\n    location.href = `//${this.props.shopDomain}/user-shop-view/shopdefaultmenu`;\r\n    // location.reload();  // 刷新当前页面\r\n  }\r\n\r\n  /*\r\n   * 判断cookie是否有companyId\r\n   * */\r\n  isCompanyIdInCookie(data) {\r\n    // 如果cookie里有companyId，但当前登陆账号里没相同的companyId则将当前账号下的第1个companyId设置到cookie里\r\n    // 刷新当前页面，重新发送带有新companyId的ajax请求\r\n    if (this.shopId && JSON.stringify(data).indexOf(this.shopId) === -1 || !this.shopId) {\r\n      cookie.set('shopId', data[0].shopId, '', this.props.doma);\r\n      cookie.set('companyId', data[0].companyId, '', this.props.doma);\r\n      cookie.set('shopType', data[0].shopType, '', this.props.doma);\r\n      location.href = `//${this.props.shopDomain}/user-shop-view/shopdefaultmenu`;\r\n      // location.reload();  // 刷新当前页面\r\n    }\r\n  }\r\n\r\n  /*\r\n   * 渲染店铺下拉列表\r\n   * */\r\n  renderOptions(data) {\r\n    const options = [];\r\n    // 判断cookie中是否存在companyId\r\n    this.isCompanyIdInCookie(data);\r\n    data.map((_item) => {\r\n      // 如果有cookie里有companyId则将店铺列表里与companyId相同的数据设置为默认\r\n      if (this.shopId && _item.shopId == this.shopId) {\r\n        this.setState({selectedTitle: `${_item.companyName}-${_item.shopName || '自营供应商店铺'}`});\r\n      }\r\n      // 生成店铺下拉列表\r\n      options.push(\r\n        <li title={`${_item.companyName}-${_item.shopName || '自营供应商店铺'}`}\r\n            className={this.shopId == _item.shopId && 'active'}\r\n            key={_item.shopId}>\r\n          <a\r\n            href=\"javascript:void(0)\"\r\n            onClick={() => this.onSelectChange({\r\n              shopId: _item.shopId,\r\n              companyId: _item.companyId,\r\n              shopType: _item.shopType\r\n            })}\r\n          >\r\n            {`${_item.companyName}-${_item.shopName || '自营供应商店铺'}`}\r\n          </a>\r\n        </li>\r\n      );\r\n    });\r\n    this.setState({options: options});\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"downMenu company\">\r\n        <a>\r\n          <p className=\"f-pre\" title={this.state.selectedTitle}>{this.state.selectedTitle}</p>\r\n          <Icon type=\"down ml5\" className=\"trans180\"/>\r\n        </a>\r\n        {this.state.options.length > 0 && (\r\n          <ul>\r\n            {this.state.options}\r\n          </ul>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}"]}