{"version":3,"sources":["../../../../../src/components/Release/ReleaseViewWrap/v1.0.0/view/ReleaseViewWrap.js"],"names":["TabPane","Loading","props","error","pastDelay","ReleaseViewWrap","context","calcRule","getTempCalcRule","state","dyComLoading","components","activeKey","ifSave","ifValid","itemId","location","edit","editStatus","editData","saleAttributeData","itemTmplPublishVo","cid","templateId","hasChannel","newType","cidChangedTimes","window","href","getUrlParam","getItemStatus","getItemInfoAction","type","queryDeliveryFareTemplate","nextProps","saveParamsRedux","tmplParams","setState","queryGetTemplateId","then","res","code","data","loadDyComponents","attrParams","getSaleAttributeAction","itemInfoRedux","itemPicpdfVoList","map","item","index","uid","itemPerfectVo","preSkuPriceVoList","length","itemTmplSkuVoList","skuItem","skuIndex","skuId","statusItem","id","areaPriceList","extendSkuFields","_item","_index","label","value","saveParamsAction","saleAttributeRedux","checkedAttributes","initDataSourceWithCheckedAttr","saveSkuListAction","that","instances","hook","JSON","parse","sourceModuleProps","Ins","loader","object","default","loading","delay","render","loaded","Component","setEditData","saveSkuListRedux","skuListData","updateSaleAttributeAction","updateItemTmplAction","indexOf","push","tabTitle","Com","url","name","pattern","RegExp","matcher","exec","items","decodeURIComponent","e","onTabClick","styles","tabIcon","i","loadTabComponents","result","releaseSaleSpecification_index","releaseSaleInfo_index","shopCategory_index","secondCategory_index","signature","releaseSaleSpecification_com","componentName","config","moduleConfig","version","releaseSaleInfo_com","splice","loadInstance","console","log","undefined","tempDS","tempRedux","tmplId","freightTmplVo","forEach","getParamsAction","ifPublish","ifPass","supplyStatus","itemStatus","storeStatus","checkedAttr","dataSource","new_checkedAttr","attrId","attrValueIds","checkedValueId","platformCategoryAttributeValues","valueItem","attrValueId","checked"],"mappings":"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","file":"ReleaseViewWrap.js","sourcesContent":["\r\n/**\r\n * @author chenyanhua\r\n * @dateTime 20180724\r\n * @file 发布商品 Tab 组件\r\n */\r\nimport React, { Component } from 'react';\r\nimport Loadable from 'react-loadable';\r\nimport { Tabs, Spin, message } from 'jdcloudui';\r\n\r\n// 基础信息 tab\r\nimport ReleaseBasicInfo from '../../../ReleaseBasicInfo/v1.0.0/view';\r\n// 商品图片 tab\r\n/*  平台  */\r\nimport ReleasePlatformGoodsImage from '../../../ReleasePlatformGoodsImage/v1.0.0/view/index';\r\n/*  供应商 店铺  */\r\nimport ReleaseShopGoodsImage from '../../../ReleaseShopGoodsImage/v1.0.0/view/index';\r\n\r\n// 其他设置 tab\r\nimport ReleaseOtherConfig from '../../../ReleaseOtherConfig/v1.0.0/view';\r\n// 价格及库存 tab\r\nimport ReleasePriceAndStock from '../../../ReleasePriceAndStock/v1.0.0/view';\r\n// 供货信息 tab\r\nimport ReleaseSupplyInfo from '../../../ReleaseSupplyInfo/v1.0.0/view';\r\n\r\n// 按钮组件\r\nimport ReleaseBtns from '../../../ReleaseBtns/v.1.0.0/view'\r\n\r\nimport styles from './style/index.less';\r\n\r\n// import ReleaseURLConfig from './ReleaseURLConfig';\r\n\r\nconst TabPane = Tabs.TabPane;\r\n\r\nfunction Loading(props) {\r\n  if (props.error) {\r\n    return <div>Error!</div>;\r\n  } else if (props.pastDelay) {\r\n    return <div style={{ 'height': '800px', 'paddingTop': '200px', 'textAlign': 'center' }}><Spin size=\"large\" /></div>;\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\nexport default class ReleaseViewWrap extends Component {\r\n  constructor(props, context) {\r\n    super(props);\r\n    // 店铺时，销售信息表格列是否需要根据模板进行列的校验\r\n    const calcRule = this.getTempCalcRule(props);\r\n\r\n    this.state = {\r\n      dyComLoading: false, // 是否正在加载动态组件\r\n      components: [],\r\n      calcRule: calcRule,\r\n      activeKey: 'basicinfo' //当前选择的tabs\r\n    };\r\n\r\n    this.ifSave = true; //判断是否展示保存按钮，默认展示\r\n    this.ifValid = false; //是否是已生效商品，默认未生效\r\n    this.itemId = '';\r\n    this.location = '';\r\n    this.edit = false; //编辑状态\r\n    this.editStatus = false; //已发布商品，并且是第一次编辑状态\r\n    this.editData = {}; //编辑状态,保存用户属性\r\n    this.saleAttributeData = []; //保存销售规格接口数据\r\n    this.itemTmplPublishVo = {}; //保存回显的总数据\r\n    this.cid = null; //保存选中的cid\r\n    this.templateId = null; //保存取到的TemplateId\r\n    this.hasChannel = false; //判断是否加载了渠道组件\r\n    this.newType = false; //是否是从供货申请审核页面进入的编辑页\r\n    this.cidChangedTimes = 0; // 类目变化了几次\r\n  }\r\n\r\n  //编辑状态,初始化设置用户属性\r\n  setEditData = (name, data) => {\r\n    this.editData[name] = data;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.location = typeof window !== 'undefined' ? window.location.href : \"\";\r\n    this.itemId = this.getUrlParam(this.location,'itemId');\r\n    this.getItemStatus();\r\n    // 如果是编辑，获取编辑数据源\r\n    if(this.edit){\r\n      this.props.getItemInfoAction(this.props.type,{itemId:this.itemId});\r\n    }\r\n\r\n    // 如果是店铺的话，查询其他设置/配送设置/运费模板\r\n    if(this.props.type == '3'){\r\n      this.props.queryDeliveryFareTemplate();\r\n    }\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps){\r\n    //根据cid查询templateId\r\n    // 更换了类目（即cid变化）\r\n    if(nextProps.saveParamsRedux.itemTmplPublishVo && nextProps.saveParamsRedux.itemTmplPublishVo.cid && nextProps.saveParamsRedux.itemTmplPublishVo.cid != this.cid){\r\n      if(this.cid){\r\n        this.cidChangedTimes = this.cidChangedTimes+1;\r\n      }\r\n      this.cid = nextProps.saveParamsRedux.itemTmplPublishVo.cid;\r\n      const tmplParams = {cid:this.cid};\r\n      this.setState({\r\n        dyComLoading: true\r\n      });\r\n      if(this.cid){\r\n        // 重新获取模板id\r\n        this.props.queryGetTemplateId(tmplParams,this.props.type).then((res)=>{\r\n          if(res.code == 0){\r\n            this.templateId = res.data;\r\n            // 加载动态tab组件，参数templateId\r\n            this.loadDyComponents(this.templateId);\r\n          } else {\r\n            if(res.data){\r\n              message.error(res.data,2)\r\n            } else {\r\n              message.error('获取该类目下的模板失败',2)\r\n            }\r\n          }\r\n        })\r\n      }\r\n      const attrParams = {\r\n        cid : this.cid,\r\n        itemId : this.itemId,\r\n      };\r\n      // 获取销售规格数据源\r\n      this.props.getSaleAttributeAction(this.props.type, this.edit, attrParams, this.editStatus);\r\n      //已发布商品，编辑回显之后，改变状态\r\n      if(!this.editStatus && this.edit && !this.ifSave) {\r\n          this.editStatus = true;\r\n      }\r\n    }\r\n\r\n    //编辑时：接口返回的回显数据，存储于this.itemTmplPublishVo，并将回显数据根据组件需要进行组装拼接\r\n    if(nextProps.itemInfoRedux && nextProps.itemInfoRedux.data && nextProps.itemInfoRedux.data.data && nextProps.itemInfoRedux.data.data != this.itemTmplPublishVo){\r\n      this.itemTmplPublishVo = nextProps.itemInfoRedux.data.data; // 回显数据\r\n      /** 将回显的数据做处理，方便组件使用 */\r\n      if(this.itemTmplPublishVo.itemPicpdfVoList){\r\n        // 其他设置内，上传组件需要传递uid\r\n        this.itemTmplPublishVo.itemPicpdfVoList.map((item,index)=>{\r\n          item.uid = index\r\n        })\r\n      }\r\n      //供货信息或价格及库存数据为null时拼接一条数据\r\n      if(this.props.type == '2' || this.props.type == '3'){\r\n        if(this.itemTmplPublishVo.itemPerfectVo && this.itemTmplPublishVo.itemPerfectVo.preSkuPriceVoList && this.itemTmplPublishVo.itemPerfectVo.preSkuPriceVoList.length > 0){\r\n          this.itemTmplPublishVo.itemTmplSkuVoList.map(statusItem=>{\r\n          this.itemTmplPublishVo.itemPerfectVo.preSkuPriceVoList.map((skuItem,skuIndex)=>{\r\n                if(skuItem.skuId == statusItem.id){\r\n                  if(skuItem && skuItem.areaPriceList == null){\r\n                    skuItem.areaPriceList = [{'areaId': 0, 'areaName': \"全国\", 'areaNumber': 1, 'supplyPrice': null}]\r\n                  }\r\n                 if(skuItem && skuItem.areaPriceList.length == 0){\r\n                  skuItem.areaPriceList = [{'areaId': 0, 'areaName': \"全国\", 'areaNumber': 1, 'supplyPrice': null}]\r\n                 }\r\n                }\r\n            })\r\n          })\r\n        } else {\r\n          message.error('获取供货信息失败',2)\r\n          this.itemTmplPublishVo.itemPerfectVo.preSkuPriceVoList[0] = {}\r\n          this.itemTmplPublishVo.itemPerfectVo.preSkuPriceVoList[0].areaPriceList = [{'areaId': 0, 'areaName': \"全国\", 'areaNumber': 1, 'supplyPrice': null}]\r\n        }\r\n      }\r\n\r\n      // 销售信息组件，处理扩展列\r\n      if(this.itemTmplPublishVo.itemTmplSkuVoList){\r\n        this.itemTmplPublishVo.itemTmplSkuVoList.map((item,index)=>{\r\n          let extendSkuFields = item.extendSkuFields;\r\n          if(extendSkuFields && extendSkuFields.length>0){\r\n            extendSkuFields.map((_item,_index)=>{\r\n              item[`extendSkuFields_${_item.label}`] = {label:_item.label,value:_item.value}\r\n            })\r\n          }\r\n        })\r\n      }\r\n      // 将回显的数据存进redux\r\n      this.props.saveParamsAction(this.itemTmplPublishVo);\r\n    }\r\n\r\n    // 销售规格接口返回的数据，存储于this.saleAttributeData\r\n    if(nextProps.saleAttributeRedux && nextProps.saleAttributeRedux.data && nextProps.saleAttributeRedux.data.data && nextProps.saleAttributeRedux.data.data!=this.saleAttributeData){\r\n      this.saleAttributeData = nextProps.saleAttributeRedux.data.data;\r\n      let checkedAttributes = this.itemTmplPublishVo && this.itemTmplPublishVo.checkedAttributes ? this.itemTmplPublishVo.checkedAttributes : [];\r\n\r\n      let saleAttributeData = [];\r\n       // 如果更换了类目，则销售规格均是未选中状态，否则添加checked = true的字段\r\n      if(this.cidChangedTimes > 0){\r\n        saleAttributeData = this.saleAttributeData;\r\n      } else {\r\n         // 拼接 checked = true 的销售规格数据源\r\n         saleAttributeData = this.initDataSourceWithCheckedAttr(checkedAttributes,this.saleAttributeData);\r\n      }\r\n\r\n      //将拼接后的数据存进redux\r\n      this.props.saveSkuListAction(saleAttributeData);\r\n    }\r\n\r\n    // 店铺时，销售信息表格列是否需要根据模板进行列的校验\r\n    const calcRule = this.getTempCalcRule(nextProps);\r\n    this.setState({\r\n      calcRule: calcRule\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 动态加载组件\r\n   * @param templateId 模板Id\r\n   */\r\n  loadDyComponents = (templateId)=>{\r\n    this.props.loadTabComponents({templateId: templateId}).then((result) => {\r\n      let data = result && result.data || {};\r\n      let releaseSaleSpecification_index = -1; // 返回数据里是否有销售规格组件\r\n      let releaseSaleInfo_index = -1; // 返回数据里是否有销售信息组件\r\n      let shopCategory_index = -1; // 返回数据里是否有店铺分类组件\r\n      let secondCategory_index = -1; // 返回数据里是否有第二分类组件\r\n      if(!data[`HOOK_BASIC_INFO_${templateId}`]){\r\n        data[`HOOK_BASIC_INFO_${templateId}`] = [];\r\n      }\r\n      // 销售规格组件内带销售信息组件，如果重复，排除掉销售信息组件\r\n      data[`HOOK_BASIC_INFO_${templateId}`].map((item, index)=>{\r\n        if(item.signature == 'ReleaseChannel'){\r\n          this.hasChannel = true;\r\n        }\r\n        if(item.signature == 'BasicShopCategory'){\r\n          shopCategory_index = index;\r\n        }\r\n        if(item.signature == 'BasicSecondCategory'){\r\n          secondCategory_index = index;\r\n        }\r\n        if(item.signature == 'ReleaseSaleSpecification'){\r\n          releaseSaleSpecification_index = index;\r\n        }\r\n        if(item.signature == 'ReleaseSaleInfo'){\r\n          releaseSaleInfo_index = index;\r\n        }\r\n      });\r\n\r\n      let releaseSaleSpecification_com = {\r\n        componentName: \"商品发布/编辑-基础信息/销售规格\",\r\n        config: \"{}\",\r\n        moduleConfig: \"{}\",\r\n        signature: \"ReleaseSaleSpecification\",\r\n        version: \"v1.0.0\"\r\n      }\r\n\r\n      let releaseSaleInfo_com = {\r\n        componentName: \"商品发布/编辑-基础信息/销售信息\",\r\n        config: \"{}\",\r\n        moduleConfig: \"{}\",\r\n        signature: \"ReleaseSaleInfo\",\r\n        version: \"v1.0.0\"\r\n      };\r\n\r\n      // 有销售规格， 没有销售信息，在销售规格后面添加销售信息\r\n      if(releaseSaleSpecification_index >=0 && releaseSaleInfo_index<0){\r\n\r\n        data[`HOOK_BASIC_INFO_${templateId}`].splice(releaseSaleSpecification_index+1, 0, releaseSaleInfo_com);\r\n\r\n      } else if(releaseSaleSpecification_index <0 && releaseSaleInfo_index >=0){\r\n\r\n        // 没有销售规格，有销售信息，在销售信息前面添加销售规格\r\n        data[`HOOK_BASIC_INFO_${templateId}`].splice(releaseSaleInfo_index, 0, releaseSaleSpecification_com);\r\n\r\n      } else if(releaseSaleSpecification_index <0 && releaseSaleInfo_index <0){\r\n\r\n        // 既没有销售规格，也没有销售信息\r\n        data[`HOOK_BASIC_INFO_${templateId}`].push(releaseSaleSpecification_com);\r\n        data[`HOOK_BASIC_INFO_${templateId}`].push(releaseSaleInfo_com);\r\n      }\r\n\r\n      //非店铺页面排除掉店铺分类组件\r\n      if(this.props.type != 3 && shopCategory_index >= 0){\r\n        data[`HOOK_BASIC_INFO_${templateId}`].splice(shopCategory_index,1);\r\n      }\r\n      // 店铺页面排除掉第二分类\r\n      if(this.props.type == 3 && secondCategory_index >= 0){\r\n        data[`HOOK_BASIC_INFO_${templateId}`].splice(secondCategory_index,1);\r\n      }\r\n      // 添加管理员信息组件，该组件一直存在\r\n      data[`HOOK_BASIC_INFO_${templateId}`].push({\r\n        componentName: \"商品发布/编辑-基础信息/管理员信息组件\",\r\n        config: \"{}\",\r\n        moduleConfig: \"{}\",\r\n        signature: \"AdminInformation\",\r\n        version: \"v1.0.0\"\r\n      });\r\n      const components = this.loadInstance(data);\r\n      this.setState({\r\n        dyComLoading: false,\r\n        components: components\r\n      });\r\n    },\r\n      (error) => {\r\n        console.log(error)\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * 店铺时，根据总数据源中的freightTmplVo.tmplId 和 运费模板数据源\r\n   * 找出销售信息组件哪个列需要进行校验：按体积，按重量，按件数\r\n   */\r\n  getTempCalcRule = (props)=>{\r\n    let calcRule = undefined;\r\n    if(props.type=='3'){\r\n      const tempDS = props.tempRedux && props.tempRedux.data || [];\r\n      const itemTmplPublishVo = props.saveParamsRedux && props.saveParamsRedux.itemTmplPublishVo || {};\r\n      const tmplId = itemTmplPublishVo.freightTmplVo && itemTmplPublishVo.freightTmplVo.tmplId || undefined;\r\n      tempDS.forEach((item)=>{\r\n        if(item.id == tmplId){\r\n          calcRule = item.calcRule;\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n    return calcRule;\r\n  }\r\n\r\n  //更新销售规格数据的方法\r\n  updateSaleAttributeAction = (data)=>{\r\n    this.props.saveSkuListAction(data);\r\n  }\r\n\r\n  //获取拼接后销售规格数据\r\n  // getNewSaleAttributeAction = () =>{\r\n  //   return this.props.saveSkuListRedux.skuListData;\r\n  // }\r\n\r\n  //获取当前已保存数据\r\n  getParamsAction = ()=>{\r\n    return this.props.saveParamsRedux\r\n  }\r\n\r\n  //更新总数据的方法\r\n  updateItemTmplAction = (data)=>{\r\n    this.props.saveParamsAction(data)\r\n  }\r\n\r\n  loadInstance(components) {\r\n    var that = this;\r\n    var instances = {};\r\n    components && Object.keys(components).map((hook) => {\r\n      components[hook].map((value) => {\r\n        if (value[\"signature\"]) {\r\n          let props = {};\r\n          //处理config-->json.parse\r\n          props = JSON.parse(value['config']);\r\n          //处理moduleConfig-->json.parse,eval\r\n          let sourceModuleProps = JSON.parse(value['moduleConfig']);\r\n          //合并config\r\n          props = Object.assign(props ? props : {}, sourceModuleProps ? sourceModuleProps : {});\r\n\r\n          var Ins = Loadable({\r\n            loader: () => import('../../..' + '/' + value[\"signature\"] + '/' + value[\"version\"] + '/view/index').then(object => object.default),\r\n            loading: Loading,\r\n            delay: 300,\r\n            render(loaded) {\r\n              let Component = loaded;\r\n              return <Component\r\n                {...props}\r\n                components = {that.state.components}\r\n                type={that.props.type}\r\n                key={`tabs_${value[\"signature\"]}`}\r\n                ifSave={that.ifSave}\r\n                ifValid={that.ifValid}\r\n                itemId={that.itemId}\r\n                edit={that.edit}\r\n                editStatus={that.editStatus}\r\n                editData={that.editData}\r\n                setEditData={that.setEditData}\r\n                getSaleAttributeAction={that.props.getSaleAttributeAction}  //请求销售规格接口的方法\r\n                saleAttributeData={that.props.saveSkuListRedux && that.props.saveSkuListRedux.skuListData || []}  //拼接后的销售规格数据\r\n                updateSaleAttributeAction={that.updateSaleAttributeAction} //更新销售规格数据的方法\r\n                updateItemTmplAction={that.updateItemTmplAction} //更新总数据的方法\r\n                itemTmplPublishVo={that.props.saveParamsRedux && that.props.saveParamsRedux.itemTmplPublishVo} //当前已保存的总数据\r\n              />;\r\n            }\r\n          });\r\n          // debugger;\r\n          instances[hook] = instances[hook] || [];\r\n          if(hook.indexOf('HOOK_TABS')>=0){\r\n            instances[hook].push({ tabTitle: props.tabTitle || '无用Tab测试', Com: Ins });\r\n          } else {\r\n            instances[hook].push(Ins);\r\n          }\r\n        }\r\n      });\r\n    });\r\n    return instances;\r\n  }\r\n\r\n  //获取url传递的参数\r\n  getUrlParam(url, name) {\r\n    var pattern = new RegExp('[?&]' + name + '\\=([^&]+)', 'g');\r\n    var matcher = pattern.exec(url);\r\n    var items = null;\r\n    if (matcher !== null) {\r\n      try {\r\n        items = decodeURIComponent(decodeURIComponent(matcher[1]));\r\n      }\r\n      catch (e) {\r\n        try {\r\n          items = decodeURIComponent(matcher[1]);\r\n        }\r\n        catch (e) {\r\n          items = matcher[1];\r\n        }\r\n      }\r\n    }\r\n    return items;\r\n  }\r\n\r\n  //获取该商品的状态值\r\n  getItemStatus = ()=>{\r\n    let ifPublish = false;//发布状态，默认未发布\r\n    let ifPass = false;//审核状态，默认未审核或未通过\r\n    const supplyStatus = this.getUrlParam(this.location,'supplyStatus');\r\n    const itemStatus = this.getUrlParam(this.location,'itemStatus');\r\n    const storeStatus = this.getUrlParam(this.location,'storeStatus');\r\n    this.newType = this.getUrlParam(this.location,'newType');\r\n    if(itemStatus){//店铺编辑\r\n      this.edit = true;\r\n      if(itemStatus != 100){//已发布\r\n        ifPublish = true;\r\n        if(itemStatus != 70){//审核通过\r\n          ifPass = true;\r\n        }\r\n      }\r\n    } else if(supplyStatus){//供应商编辑\r\n      this.edit = true;\r\n      if(supplyStatus != 10){//已发布\r\n        ifPublish = true;\r\n        if(supplyStatus != 30){//审核通过\r\n          ifPass = true;\r\n        }\r\n      }\r\n    } else if(storeStatus){//平台编辑\r\n      this.edit = true;\r\n      if(storeStatus != 10){//已发布\r\n        ifPublish = true;\r\n      }\r\n      ifPass = true;//平台发布的商品无需审核\r\n    }\r\n    this.ifSave = !ifPublish; //未发布时展示保存按钮\r\n    if(ifPublish && ifPass){ //未发布或已驳回状态是未生效数据，已发布并且审核通过则是已生效数据\r\n      this.ifValid = true;\r\n    }\r\n  }\r\n\r\n  // 重新构造销售规格数据源，添加上是否checked\r\n  initDataSourceWithCheckedAttr = (checkedAttr, dataSource)=>{\r\n    var new_checkedAttr = {};\r\n    checkedAttr.forEach((item) => {\r\n      new_checkedAttr[item.attrId] = item.attrValueIds;\r\n    });\r\n    dataSource.forEach((item) => {\r\n      (new_checkedAttr[item.attrId] || []).forEach((checkedValueId)=>{\r\n        item.platformCategoryAttributeValues.forEach((valueItem)=>{\r\n          if(valueItem.attrValueId == checkedValueId){\r\n            valueItem.checked = true;\r\n          }\r\n        })\r\n      });\r\n    });\r\n    return dataSource;\r\n  }\r\n\r\n  onTabClick=(e)=>{\r\n    if(this.cid){\r\n      this.setState({activeKey:e})\r\n    } else {\r\n      message.error(\"请先选择平台分类！\")\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <Tabs defaultActiveKey=\"basicinfo\" animated={false} onTabClick={this.onTabClick} activeKey={this.state.activeKey}>\r\n          <TabPane tab={<span className={styles.tabIcon}><i>*</i>基础信息</span>} key='basicinfo'>\r\n            <ReleaseBasicInfo\r\n              components = { this.state.components }\r\n              ifSave={this.ifSave}\r\n              dyComLoading={this.state.dyComLoading}\r\n              ifValid={this.ifValid}\r\n              templateId={this.templateId}\r\n              type={this.props.type}\r\n              editStatus={this.editStatus}\r\n              editData={this.editData}\r\n              setEditData={this.setEditData}\r\n              saleAttributeData={this.props.saveSkuListRedux && this.props.saveSkuListRedux.skuListData || []}  //拼接后的销售规格数据\r\n              updateSaleAttributeAction={this.updateSaleAttributeAction} //更新销售规格数据的方法\r\n              updateItemTmplAction={this.updateItemTmplAction} //更新总数据的方法\r\n              itemTmplPublishVo={this.props.saveParamsRedux && this.props.saveParamsRedux.itemTmplPublishVo} // 发布、保存、编辑，总数据源\r\n            />\r\n          </TabPane>\r\n          <TabPane tab={<span className={styles.tabIcon}><i>*</i>商品图片</span>} key='image'>\r\n              {\r\n                this.props.type == '1'?\r\n                    <ReleasePlatformGoodsImage\r\n                        saleAttributeData={this.props.saveSkuListRedux && this.props.saveSkuListRedux.skuListData || []}  //拼接后的销售规格数据\r\n                        updateItemTmplAction={this.updateItemTmplAction} //更新总数据的方法\r\n                        itemTmplPublishVo={this.props.saveParamsRedux && this.props.saveParamsRedux.itemTmplPublishVo} //当前已保存的总数据\r\n                    />:\r\n                    <ReleaseShopGoodsImage\r\n                        saleAttributeData={this.props.saveSkuListRedux && this.props.saveSkuListRedux.skuListData || []}  //拼接后的销售规格数据\r\n                        updateItemTmplAction={this.updateItemTmplAction} //更新总数据的方法\r\n                        itemTmplPublishVo={this.props.saveParamsRedux && this.props.saveParamsRedux.itemTmplPublishVo} //当前已保存的总数据\r\n                    />\r\n              }\r\n          </TabPane>\r\n          {\r\n            /* 动态加载tab组件 */\r\n            (this.state.components[`HOOK_TABS_${this.templateId}`] || []).map((item, i) => {\r\n              let Com = item.Com;\r\n              return (\r\n                <TabPane tab={item.tabTitle} key={`tab_${i}`}>\r\n                  <Com />\r\n                </TabPane>\r\n              )\r\n            })\r\n          }\r\n          <TabPane tab={<span className={styles.tabIcon}><i>*</i>其他设置</span>} key='other'>\r\n            <ReleaseOtherConfig\r\n                type={this.props.type}\r\n                itemTmplPublishVo = {this.props.saveParamsRedux && this.props.saveParamsRedux.itemTmplPublishVo} //当前已保存的总数据\r\n                updateItemTmplAction = {this.updateItemTmplAction}\r\n            />\r\n          </TabPane>\r\n          {/*{this.props.type == 3?\r\n            <TabPane tab={<span className={styles.tabIcon}><i>*</i>价格及库存</span>} key='priceAndStock'>\r\n              <ReleasePriceAndStock\r\n                edit={this.edit}\r\n                type={this.props.type}\r\n                itemTmplPublishVo = {this.props.saveParamsRedux && this.props.saveParamsRedux.itemTmplPublishVo} //当前已保存的总数据\r\n                updateItemTmplAction = {this.updateItemTmplAction}\r\n                templateId={this.templateId}\r\n                components={this.state.components}\r\n              />\r\n            </TabPane>\r\n          :null}*/}\r\n          {\r\n            this.props.type == 3 ?\r\n                /* 动态加载tab组件 */\r\n                (\r\n                    <TabPane tab={<span className={styles.tabIcon}><i>*</i>价格及库存</span>} key='priceAndStock'>\r\n                      {\r\n                        (this.state.components[`HOOK_PRICE_STOCK_TABS_${this.templateId}`] || []).map((item, i) => {\r\n                          const Com = item;\r\n                          return (\r\n                              <Com\r\n                                  key={`tab_${i}`}\r\n                                  edit={this.edit}\r\n                                  type={this.props.type}\r\n                                  itemTmplPublishVo={this.props.saveParamsRedux && this.props.saveParamsRedux.itemTmplPublishVo} //当前已保存的总数据\r\n                                  updateItemTmplAction={this.updateItemTmplAction}\r\n                              />\r\n                          )\r\n                        })\r\n                      }\r\n                    </TabPane>\r\n                )\r\n                : null\r\n          }\r\n          {this.props.type == 2?\r\n            <TabPane tab={<span className={styles.tabIcon}><i>*</i>供货信息</span>} key='supplyInfo'>\r\n              <ReleaseSupplyInfo\r\n                edit={this.edit}\r\n                type={this.props.type}\r\n                itemTmplPublishVo = {this.props.saveParamsRedux && this.props.saveParamsRedux.itemTmplPublishVo} //当前已保存的总数据\r\n                updateItemTmplAction = {this.updateItemTmplAction}/>\r\n            </TabPane>\r\n          :null}\r\n        </Tabs>\r\n        <ReleaseBtns\r\n          ifSave={this.ifSave}\r\n          ifValid={this.ifValid}\r\n          itemId={this.itemId}\r\n          edit={this.edit}\r\n          type={this.newType?'0':this.props.type}\r\n          calcRule={this.state.calcRule} // 店铺时，根据该字段判断销售信息表格校验列\r\n          updateItemTmplAction = {this.updateItemTmplAction} //更新总数据的方法\r\n          itemTmplPublishVo = {this.props.saveParamsRedux && this.props.saveParamsRedux.itemTmplPublishVo} //当前已保存的总数据\r\n          hasChannel = {this.hasChannel} //是否加载了渠道组件\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"]}