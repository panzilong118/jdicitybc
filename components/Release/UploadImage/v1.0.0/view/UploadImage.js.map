{"version":3,"sources":["../../../../../src/components/Release/UploadImage/v1.0.0/view/UploadImage.js"],"names":["config","top","duration","uploadFlag","getBase64","img","callback","imageUrl","reader","FileReader","addEventListener","result","readAsDataURL","UploadImg","props","context","beforeUpload","file","maxFileSize","fileSizeType","imgTypes","imgType","isLt2M","isImgTypes","fileName","name","length","fileTypes","split","type","toUpperCase","map","types","index","indexOf","size","parseInt","error","handleChange","info","status","loading","response","code","picture","data","setState","attr","relation","onChange","obj","msg","onRemove","url","state","undefined","nextProps","style","action","wrapClassName","className","bind","Component"],"mappings":"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","file":"UploadImage.js","sourcesContent":["/**\r\n * shop 上传图片，携带重新上传和删除按钮\r\n */\r\nimport React, { Component } from 'react';\r\nimport {message,Upload,Icon} from 'jdcloudui';\r\nimport './style/index.css';\r\nmessage.config({\r\n  top: 300,\r\n  duration: 2,\r\n});\r\nlet uploadFlag = true;\r\nfunction getBase64(img, callback,imageUrl) {\r\n  const reader = new FileReader();\r\n  if(imageUrl && imageUrl!=''){\r\n    reader.addEventListener('load', () => callback(imageUrl));\r\n    //reader.readAsDataURL(imageUrl);\r\n  }else{\r\n    reader.addEventListener('load', () => callback(reader.result));\r\n    reader.readAsDataURL(img);\r\n  }\r\n}\r\nexport default class UploadImg extends Component {\r\n  constructor(props, context) {\r\n    super(props, context);\r\n    this.state={\r\n      imageUrl: props.imageUrl || ''\r\n    };\r\n  }\r\n  componentWillReceiveProps(nextProps){\r\n    this.setState({\r\n      imageUrl: nextProps.imageUrl || ''\r\n    });\r\n  }\r\n  beforeUpload =(file)=>{\r\n    const maxFileSize = this.props.maxFileSize;\r\n    let fileSizeType = this.props.fileSizeType;\r\n    let imgTypes = this.props.imgType;\r\n    var isLt2M = true,isImgTypes=true;\r\n    var fileName = file.name;\r\n    //var validate= file.type === 'image/jpeg';\r\n    if(imgTypes && imgTypes.length>0){\r\n      var fileTypes=fileName.split('.');\r\n      var type = fileTypes[fileTypes.length-1];\r\n      type = type.toUpperCase();\r\n      imgTypes = imgTypes.map((types,index)=>{\r\n        return types.toUpperCase();\r\n      });\r\n      if(imgTypes.indexOf(type)=== -1){//文件类型不在用户指定的范围内\r\n        isImgTypes =false;\r\n      }\r\n    }\r\n    if(maxFileSize && file.size){\r\n      if(fileSizeType && (fileSizeType.toUpperCase()=='M' ||\r\n        fileSizeType.toUpperCase()=='MB')){\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024*1024;\r\n      }else if(fileSizeType && fileSizeType.toUpperCase()=='KB'){\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024;\r\n      }else if(fileSizeType && fileSizeType.toUpperCase()=='B'){\r\n        isLt2M = file.size <= parseInt(maxFileSize);\r\n      }else{\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024*1024;//默认fileSizeType=='M'\r\n      }\r\n    }\r\n    if(!isImgTypes){\r\n      message.error('上传图片的文件格式有误!');\r\n      return false;\r\n    }\r\n    if (!isLt2M) {\r\n      if(!fileSizeType){\r\n        fileSizeType ='M';\r\n      }\r\n      message.error('上传图片的文件大小必须小于'+maxFileSize+fileSizeType+'!');\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  handleChange = (info) => {\r\n    if(info.file.status === 'uploading'){\r\n      if(uploadFlag){\r\n        message.loading('正在上传中，请稍等....',1);\r\n      }\r\n      uploadFlag = false;\r\n    }\r\n    if (info.file.status === 'done') {\r\n      uploadFlag = true;\r\n      var response=info.file.response;\r\n      if(response && response.code=='0'){\r\n        var picture = response.data;\r\n        this.setState({imageUrl:picture});\r\n        var attr = this.props.relation;\r\n        let {onChange} = this.props;\r\n        var obj={};\r\n        obj[attr]= picture;\r\n        onChange(obj);\r\n        //getBase64(info.file.originFileObj, imageUrl => this.setState({ imageUrl }),picture.pictureURL);\r\n      }else{\r\n        if(response && response.code=='-1'){\r\n          message.error(response.msg)\r\n        }else{\r\n          message.error(\"上传失败！\");\r\n        }\r\n        let {onChange} = this.props;\r\n        var obj={};\r\n        onChange(obj);\r\n      }\r\n    }\r\n    if (info.file.status === 'error') {\r\n      uploadFlag = true;\r\n      message.error(\"上传失败！\")\r\n    }\r\n  }\r\n  \r\n  //移除\r\n  onRemove = ()=>{\r\n    //更新图片\r\n    if(this.props.onRemove && typeof this.props.onRemove=='function'){\r\n      this.props.onRemove({url: this.state.imageUrl});\r\n    }\r\n    this.setState({\r\n      imageUrl: undefined\r\n    });\r\n  }\r\n\r\n  render(){\r\n    //const styles = require('./style/UploadImg.less');\r\n    let style = this.props.style || {};\r\n    const action = this.props.action;\r\n    const data =this.props.data;\r\n    const name = this.props.name;\r\n    let imageUrl = this.state.imageUrl || '';\r\n\r\n    let wrapClassName = 'upload-select-wrap ' + (this.props.className || '');\r\n    if(imageUrl && imageUrl.length>0){\r\n      wrapClassName += ' solid-border';\r\n    }\r\n    return(\r\n      <div className={wrapClassName} style={style}>\r\n        {\r\n          imageUrl && imageUrl!='' ?\r\n          <div class=\"upload-select-box\">\r\n            <img src={imageUrl} />\r\n            <div class=\"upload-select-footer\">\r\n              <Upload\r\n                name={name}\r\n                showUploadList={false}\r\n                action={action}\r\n                beforeUpload={this.beforeUpload.bind(this)}\r\n                onChange={this.handleChange.bind(this)}\r\n                data={data}\r\n              >\r\n                <div class=\"upload-select-btn\">重新上传</div>\r\n              </Upload>\r\n              <div class=\"upload-select-removebtn\" onClick={this.onRemove}>删除</div>\r\n            </div>\r\n          </div>\r\n          :\r\n            <Upload\r\n              name={name}\r\n              showUploadList={false}\r\n              action={action}\r\n              beforeUpload={this.beforeUpload.bind(this)}\r\n              onChange={this.handleChange.bind(this)}\r\n              data={data}\r\n            >\r\n              <div className='upload-select-defaultbtn'>\r\n                <Icon type=\"plus\" className='upload-plus' /> <br/>上传图片\r\n              </div>\r\n            </Upload>\r\n        }\r\n      </div>\r\n    )\r\n  }\r\n  \r\n}"]}