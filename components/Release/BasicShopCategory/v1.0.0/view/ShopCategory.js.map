{"version":3,"sources":["../../../../../src/components/Release/BasicShopCategory/v1.0.0/view/ShopCategory.js"],"names":["Option","listTip","allowClear","ShopCategory","props","context","handleSecondCategoryChange","cid","setState","secondValue","detailIndex","getShopCidRedux","second","data","handleChangeCategoryValue","secondLeaf","handleFirstCategoryChange","firstValue","firstOn","secondOn","secondCategoryOptions","first","getSecondCid","then","result","length","state","firstLeaf","clearData","firstCategoryOptions","currentIndex","shopCids","parentCid","getFirstCid","nextProps","itemTmplPublishVo","split","ifHasLeaf","undefined","shopCid","updateItemTmplAction","category","index","hasLeaf","map","item","firstResult","cName","secondResult","firstloaded","dataSource","secondloaded","styles","labelWrap","labelTitle","labelCont","Component"],"mappings":"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","file":"ShopCategory.js","sourcesContent":["/**\r\n * 平台分类组件：四级类目级联选择框\r\n */\r\nimport React, { Component }  from 'react';\r\nimport { Select ,Tooltip } from 'jdcloudui';\r\nimport styles from './style/category.less';\r\nimport './style/style.css';\r\n\r\nconst Option = Select.Option;\r\nconst listTip = '请选择类目';\r\nconst allowClear = true;\r\n\r\nexport default class ShopCategory extends Component {\r\n  constructor(props,context) {\r\n    super(props,context);\r\n    this.state={\r\n      firstLeaf: false, //一级类目是否是叶子节点\r\n      secondLeaf: false, //二级类目是否是叶子节点\r\n      firstValue: null,\r\n      secondValue: null,\r\n    };\r\n\r\n    this.firstCategoryOptions = null;\r\n    this.secondCategoryOptions = null;\r\n    this.firstLeaf = false;\r\n    this.secondLeaf = false;\r\n    \r\n    this.currentIndex = 0;\r\n    this.firstOn = true;\r\n    this.secondOn = false;\r\n    this.shopCids = ''; //用于保存类目回显数据\r\n  }\r\n\r\n  componentWillMount() {\r\n    //请求一级类目\r\n    let parentCid = -1;\r\n    this.props.getFirstCid(parentCid);\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps){\r\n    if(nextProps.itemTmplPublishVo){\r\n      if(nextProps.itemTmplPublishVo.shopCids && nextProps.itemTmplPublishVo.shopCids != this.shopCids){\r\n        this.shopCids = nextProps.itemTmplPublishVo.shopCids;\r\n        //数据回显\r\n        let shopCids = this.shopCids.split('-');\r\n\r\n        switch(shopCids.length){\r\n          case 1: \r\n            this.setState({ firstLeaf:true });\r\n            this.firstLeaf = true;\r\n            this.handleFirstCategoryChange(shopCids[0]);\r\n            return;\r\n          case 2: \r\n            this.setState({ secondLeaf:true });\r\n            this.secondLeaf = true;\r\n            this.handleFirstCategoryChange(shopCids[0]);\r\n            this.handleSecondCategoryChange(shopCids[1]);\r\n            return;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  //保存终极类目cid\r\n  handleChangeCategoryValue(cid, ifHasLeaf) {\r\n    let itemTmplPublishVo = this.props.itemTmplPublishVo;\r\n      if(cid == undefined){\r\n        cid = null\r\n      }\r\n      itemTmplPublishVo.shopCid = cid\r\n      this.props.updateItemTmplAction(itemTmplPublishVo)\r\n  }\r\n\r\n  detailIndex(cid, category , index){//判断当前是否是根节点\r\n    let hasLeaf = false;\r\n    if(category && category.length > 0){\r\n      category.map((item, index) => {\r\n        if(item.cid == cid){\r\n          this.currentIndex = index;\r\n          if(category[this.currentIndex].hasLeaf == 1){\r\n            hasLeaf = true;\r\n          }\r\n        }\r\n      });\r\n    }\r\n    switch (index){\r\n      case 1:\r\n        this.setState({firstLeaf: hasLeaf});\r\n        this.firstLeaf = hasLeaf;\r\n      case 2: \r\n        this.setState({secondLeaf: hasLeaf});\r\n        this.secondLeaf = hasLeaf;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取二级类目cid，返回组件对外提供的方法上面，供父组件使用\r\n   * @param cid\r\n   */\r\n  handleSecondCategoryChange=(cid)=> {\r\n    this.setState({\r\n      secondValue: cid\r\n    });\r\n    this.detailIndex(cid, this.props.getShopCidRedux.second.data.data, 2);\r\n    this.handleChangeCategoryValue(cid, this.secondLeaf);\r\n  }\r\n\r\n  /**\r\n   * 查询二级类目\r\n   * @param cid\r\n   */\r\n  handleFirstCategoryChange=(cid)=> {\r\n    this.setState({\r\n      firstValue: cid,\r\n      secondValue: null,\r\n      secondLeaf: false,\r\n    });\r\n    this.firstOn = true;\r\n    this.secondOn = true;\r\n    this.secondCategoryOptions = null;\r\n    if (cid) {\r\n      this.detailIndex(cid, this.props.getShopCidRedux.first.data.data, 1);\r\n      this.props.getSecondCid(cid).then(\r\n        (result) => {\r\n          if(result.data && result.data.length < 1){\r\n            if(!this.state.firstLeaf){\r\n\r\n              this.secondCategoryOptions = [];\r\n              this.secondOn = false;\r\n            }else{\r\n               this.setState({\r\n                  secondValue: null,\r\n                });\r\n              this.secondCategoryOptions = null;\r\n            }\r\n          }\r\n        }\r\n      );\r\n    } else{\r\n      this.secondCategoryOptions = null;\r\n      this.props.clearData(1);\r\n    }\r\n    this.handleChangeCategoryValue(cid, this.firstLeaf);\r\n  }\r\n\r\n  dataSource() {\r\n    return {\r\n      first:()=>{\r\n        if (this.props.getShopCidRedux.first.data){\r\n          let firstResult = this.props.getShopCidRedux.first.data.data;\r\n          if (firstResult && firstResult.length > 0){\r\n            this.firstCategoryOptions = firstResult.map(first => <Option  title = {first.cName}  key={first.cid}>\r\n                  {first.cName}\r\n            </Option>);\r\n          } \r\n        }\r\n      },\r\n      second:()=>{\r\n        if (this.props.getShopCidRedux.second.data){\r\n          let secondResult = this.props.getShopCidRedux.second.data.data;\r\n          if (secondResult && secondResult.length > 0){\r\n            this.secondCategoryOptions = secondResult.map(second => <Option title = {second.cName}  key={second.cid}>{second.cName}</Option>);\r\n          }\r\n        }\r\n\t\t\t}\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.firstOn && this.props.getShopCidRedux.first.firstloaded && this.dataSource().first();\r\n    this.secondOn && this.props.getShopCidRedux.second.secondloaded && this.dataSource().second();\r\n\r\n    return (\r\n      <div className={styles.labelWrap}>\r\n        <label className={styles.labelTitle}>店铺：</label>\r\n        <div className={styles.labelCont}>\r\n        {/*一级类目变化*/}\r\n          <Select\r\n              placeholder='请选择'\r\n              value = {this.state.firstValue} \r\n              notFoundContent={listTip} \r\n              allowClear={allowClear} \r\n              size=\"large\" \r\n              className=\"select\"\r\n              onChange={this.handleFirstCategoryChange}>\r\n                  {this.firstCategoryOptions}\r\n          </Select>\r\n        {/*二级类目变化*/}\r\n          <Select\r\n              disabled = { this.state.firstLeaf } \r\n              placeholder='请选择'\r\n              notFoundContent={listTip} \r\n              allowClear={allowClear} \r\n              size=\"large\" \r\n              className=\"select\"\r\n              onChange={this.handleSecondCategoryChange}\r\n              value = {this.state.secondValue} >\r\n                  {this.secondCategoryOptions} \r\n          </Select>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}"]}