{"version":3,"sources":["../../../../../src/components/Release/UploadFile/v1.0.0/view/UploadFile.js"],"names":["config","top","duration","UploadFile","props","beforeUpload","file","maxFileSize","fileSizeType","propsFileTypes","fileType","isLt2M","isFileTypes","fileName","name","length","fileTypes","split","type","toUpperCase","map","types","index","indexOf","size","parseInt","error","canUpload","onChange","info","setState","fileList","status","response","code","fileUrl","data","onFileListChange","uid","url","success","msg","state","nextProps","action","disabled","fileLength","btnTitle","onRemove","Component"],"mappings":"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","file":"UploadFile.js","sourcesContent":["/**\r\n * @file 文件上传组件\r\n * @author chenyanhua\r\n * @date 2018-08-02 \r\n */\r\nimport React, { Component } from 'react';\r\nimport { message, Upload, Icon, Button } from 'jdcloudui';\r\nmessage.config({\r\n  top: 300,\r\n  duration: 2,\r\n});\r\n\r\nexport default class UploadFile extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.canUpload = true; // 格式大小是否满足要求\r\n    this.state = {\r\n      fileList: props.fileList || []// 文件列表\r\n    };\r\n  }\r\n  componentWillReceiveProps(nextProps) {\r\n    this.setState({\r\n      fileList: nextProps.fileList || []\r\n    });\r\n  }\r\n  render() {\r\n    let { action, disabled, fileLength, btnTitle='上传' } = this.props;\r\n    let { fileList } = this.state;\r\n    let props = {\r\n      action: action,\r\n      disabled: disabled,\r\n      beforeUpload: this.beforeUpload,\r\n      onChange: this.onChange,\r\n      onRemove: this.props.onRemove\r\n    };\r\n    return (\r\n      <div>\r\n        <Upload {...props} fileList = {fileList}>\r\n          {\r\n            fileList.length < fileLength ?\r\n            (<Button disabled={disabled}>\r\n              <Icon type=\"upload\" />{btnTitle}\r\n            </Button>) : null\r\n          }\r\n          \r\n        </Upload>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // 上传前做处理\r\n  beforeUpload = (file) => {\r\n    const maxFileSize = this.props.maxFileSize;\r\n    let fileSizeType = this.props.fileSizeType;\r\n    let propsFileTypes = this.props.fileType;\r\n    var isLt2M = true,isFileTypes=true;\r\n    var fileName = file.name;\r\n    //var validate= file.type === 'image/jpeg';\r\n    if(propsFileTypes && propsFileTypes.length>0){\r\n      var fileTypes=fileName.split('.');\r\n      var type = fileTypes[fileTypes.length-1];\r\n      type = type.toUpperCase();\r\n      propsFileTypes = propsFileTypes.map((types,index)=>{\r\n        return types.toUpperCase();\r\n      });\r\n      if(propsFileTypes.indexOf(type)=== -1){//文件类型不在用户指定的范围内\r\n        isFileTypes =false;\r\n      }\r\n    }\r\n    if(maxFileSize && file.size){\r\n      if(fileSizeType && (fileSizeType.toUpperCase()=='M' ||\r\n        fileSizeType.toUpperCase()=='MB')){\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024*1024;\r\n      }else if(fileSizeType && fileSizeType.toUpperCase()=='KB'){\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024;\r\n      }else if(fileSizeType && fileSizeType.toUpperCase()=='B'){\r\n        isLt2M = file.size <= parseInt(maxFileSize);\r\n      }else{\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024*1024;//默认fileSizeType=='M'\r\n      }\r\n    }\r\n    if(!isFileTypes){\r\n      message.error('上传图片的文件格式有误!');\r\n      this.canUpload = false;\r\n      return false;\r\n    }\r\n    if (!isLt2M) {\r\n      if(!fileSizeType){\r\n        fileSizeType ='M';\r\n      }\r\n      message.error('上传图片的文件大小必须小于'+maxFileSize+fileSizeType+'!');\r\n      this.canUpload = false;\r\n      return false;\r\n    }\r\n    this.canUpload = true;\r\n    return true;\r\n  };\r\n\r\n  // 文件上传过程\r\n  onChange = (info) => {\r\n    if( this.canUpload ){\r\n      this.setState({\r\n        fileList: info.fileList\r\n      });\r\n      if (info.file.status === 'done') {\r\n        var response = info.file.response;\r\n        if (response && response.code == '0') {\r\n          let fileUrl = response.data;\r\n          // 向父级组件返回上传文件信息\r\n          const { onChange, onFileListChange } = this.props;\r\n          if (onChange) {\r\n            onChange({\r\n              uid: info.file.uid,\r\n              url: fileUrl,\r\n              name: info.file.name\r\n            });\r\n          }\r\n          if(onFileListChange){\r\n            onFileListChange(info.fileList);\r\n          }\r\n          message.success('文件上传成功');\r\n        } else {\r\n          if (response && response.code == '-1') {\r\n            message.error(response.msg)\r\n          } else {\r\n            message.error(\"上传失败！\");\r\n          }\r\n          let { onChange, onFileListChange } = this.props;\r\n          if(onChange){\r\n            onChange({});\r\n          }\r\n          if(onFileListChange){\r\n            onFileListChange(info.fileList);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  } \r\n}"]}