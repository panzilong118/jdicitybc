{"version":3,"sources":["../../src/components/UploadImg/UploadImg.js"],"names":["RadioGroup","Group","Option","FormItem","Item","formItemLayout","labelCol","span","wrapperCol","formItemLayout2","tailFormItemLayout","offset","config","top","duration","getBase64","img","callback","imgURL","reader","FileReader","addEventListener","result","readAsDataURL","UploadImg","props","context","beforeUpload","file","maxFileSize","fileSizeType","imgTypes","imgType","isLt2M","isImgTypes","fileName","name","length","fileTypes","split","type","toUpperCase","map","types","index","indexOf","size","parseInt","error","handleChange","info","status","response","code","picture","data","JSON","parse","imgUrl","pictureURL","setState","imageUrl","attr","relation","onChangeValue","obj","state","style","action","defaultValue","console","log","width","height","bind","Component"],"mappings":"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","file":"UploadImg.js","sourcesContent":["import React, { Component } from 'react';\r\nimport { Router, Route, Link } from 'react-router'\r\nimport {Form,Input,Select,message,Radio,Upload,Icon} from 'jdcloudui';\r\nimport './style/UploadImg.css';\r\nconst RadioGroup = Radio.Group;\r\nconst Option = Select.Option;\r\nconst FormItem = Form.Item;\r\nconst formItemLayout = {\r\n  labelCol: { span: 2 },\r\n  wrapperCol: { span:6},\r\n};\r\nconst formItemLayout2 = {\r\n  labelCol: { span: 2 },\r\n  wrapperCol: { span:10},\r\n};\r\nconst tailFormItemLayout = {\r\n  wrapperCol: {\r\n    span: 10,\r\n    offset: 2,\r\n  },\r\n};\r\nmessage.config({\r\n  top: 300,\r\n  duration: 2,\r\n});\r\nfunction getBase64(img, callback,imgURL) {\r\n  const reader = new FileReader();\r\n  if(imgURL && imgURL!=''){\r\n    reader.addEventListener('load', () => callback(imgURL));\r\n    //reader.readAsDataURL(imgURL);\r\n  }else{\r\n    reader.addEventListener('load', () => callback(reader.result));\r\n    reader.readAsDataURL(img);\r\n  }\r\n}\r\nexport default class UploadImg extends Component {\r\n  constructor(props, context) {\r\n    super(props, context);\r\n    this.state={imageUrl:''};\r\n    this.imgUrl='';\r\n  }\r\n  beforeUpload =(file)=>{\r\n    const maxFileSize = this.props.maxFileSize;\r\n    let fileSizeType = this.props.fileSizeType;\r\n    let imgTypes = this.props.imgType;\r\n    var isLt2M = true,isImgTypes=true;\r\n    var fileName = file.name;\r\n    //var validate= file.type === 'image/jpeg';\r\n    if(imgTypes && imgTypes.length>0){\r\n      var fileTypes=fileName.split('.');\r\n      var type = fileTypes[fileTypes.length-1];\r\n      type = type.toUpperCase();\r\n      imgTypes = imgTypes.map((types,index)=>{\r\n        return types.toUpperCase();\r\n      });\r\n      if(imgTypes.indexOf(type)=== -1){//文件类型不在用户指定的范围内\r\n        isImgTypes =false;\r\n      }\r\n    }\r\n    if(maxFileSize){\r\n      if(fileSizeType && (fileSizeType.toUpperCase()=='M' ||\r\n        fileSizeType.toUpperCase()=='MB')){\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024*1024;\r\n      }else if(fileSizeType && fileSizeType.toUpperCase()=='KB'){\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024;\r\n      }else if(fileSizeType && fileSizeType.toUpperCase()=='B'){\r\n        isLt2M = file.size <= parseInt(maxFileSize);\r\n      }else{\r\n        isLt2M = file.size <= parseInt(maxFileSize)*1024*1024;//默认fileSizeType=='M'\r\n      }\r\n    }\r\n    if(!isImgTypes){\r\n      message.error('上传图片的文件格式有误!');\r\n      return false;\r\n    }\r\n    if (!isLt2M) {\r\n      if(!fileSizeType){\r\n        fileSizeType ='M';\r\n      }\r\n      message.error('上传图片的文件大小必须小于'+maxFileSize+fileSizeType+'!');\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  handleChange = (info) => {\r\n    if (info.file.status === 'done') {\r\n      var response=info.file.response;\r\n      if(response && response.code=='0'){\r\n        var picture = response.data;\r\n        if(typeof(picture)=='string'){\r\n          picture=JSON.parse(picture);\r\n        }\r\n        this.imgUrl = picture.pictureURL;\r\n        this.setState({imageUrl:picture.pictureURL});\r\n        var attr = this.props.relation;\r\n        let {onChangeValue} = this.props;\r\n        var obj={};\r\n        obj[attr]=picture.pictureURL;\r\n        onChangeValue(obj);\r\n        //getBase64(info.file.originFileObj, imageUrl => this.setState({ imageUrl }),picture.pictureURL);\r\n      }else{\r\n        let {onChangeValue} = this.props;\r\n        var obj={};\r\n        onChangeValue(obj);\r\n      }\r\n    }\r\n    if (info.file.status === 'error') {\r\n      message.error(\"上传失败！\")\r\n    }\r\n  }\r\n\r\n  render(){\r\n    //const styles = require('./style/UploadImg.less');\r\n    let style = this.props.style;\r\n    const action = this.props.action;\r\n    const data =this.props.data;\r\n    const name = this.props.name;\r\n    let defaultValue = this.props.defaultValue;\r\n    let imageUrl = '';\r\n    if(defaultValue){\r\n      if(this.state.imageUrl){\r\n        imageUrl = this.state.imageUrl;\r\n      }else{\r\n        imageUrl = defaultValue;\r\n      }\r\n    }else{\r\n      imageUrl = this.state.imageUrl;\r\n    }\r\n    console.log(imageUrl);\r\n    if(!style || style==''){\r\n      style ={width:'150px',height:'150px'};\r\n    }\r\n    return(\r\n      <div>\r\n        <Upload className=\"avatar-uploader\"\r\n                name={name}\r\n                showUploadList={false}\r\n                action={action}\r\n                beforeUpload={this.beforeUpload.bind(this)}\r\n                onChange={this.handleChange.bind(this)}\r\n                data={data}\r\n        >\r\n          {imageUrl&& imageUrl!='' ?\r\n              <img src={imageUrl} alt=\"\" className=\"avatar\" style={style}/> :\r\n              <Icon type=\"plus\" className=\"avatar-uploader-trigger\" style={style}/>\r\n          }\r\n        </Upload>\r\n      </div>\r\n    )\r\n  }\r\n}"]}