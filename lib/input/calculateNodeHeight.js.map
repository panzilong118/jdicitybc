{"version":3,"sources":["../../components/input/calculateNodeHeight.js"],"names":["calculateNodeHeight","HIDDEN_TEXTAREA_STYLE","SIZING_STYLE","computedStyleCache","hiddenTextarea","calculateNodeStyling","node","useCache","nodeRef","getAttribute","style","window","getComputedStyle","boxSizing","getPropertyValue","paddingSize","parseFloat","borderSize","sizingStyle","map","name","join","nodeInfo","uiTextNode","minRows","maxRows","document","createElement","body","appendChild","setAttribute","removeAttribute","value","placeholder","minHeight","Number","MIN_SAFE_INTEGER","maxHeight","MAX_SAFE_INTEGER","height","scrollHeight","overflowY","singleRowHeight","Math","max","min"],"mappings":"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","file":"calculateNodeHeight.js","sourcesContent":["// Thanks to https://github.com/andreypopp/react-textarea-autosize/\n\n/**\n * calculateNodeHeight(uiTextNode, useCache = false)\n */\n\nconst HIDDEN_TEXTAREA_STYLE = `\n  min-height:0 !important;\n  max-height:none !important;\n  height:0 !important;\n  visibility:hidden !important;\n  overflow:hidden !important;\n  position:absolute !important;\n  z-index:-1000 !important;\n  top:0 !important;\n  right:0 !important\n`;\n\nconst SIZING_STYLE = [\n    'letter-spacing',\n    'line-height',\n    'padding-top',\n    'padding-bottom',\n    'font-family',\n    'font-weight',\n    'font-size',\n    'text-rendering',\n    'text-transform',\n    'width',\n    'text-indent',\n    'padding-left',\n    'padding-right',\n    'border-width',\n    'box-sizing',\n];\n\nconst computedStyleCache = {};\nlet hiddenTextarea;\n\nfunction calculateNodeStyling(node, useCache = false) {\n    const nodeRef = (\n        node.getAttribute('id') ||\n        node.getAttribute('data-reactid') ||\n        node.getAttribute('name')\n    );\n\n    if (useCache && computedStyleCache[nodeRef]) {\n        return computedStyleCache[nodeRef];\n    }\n\n    const style = window.getComputedStyle(node);\n\n    const boxSizing = (\n        style.getPropertyValue('box-sizing') ||\n        style.getPropertyValue('-moz-box-sizing') ||\n        style.getPropertyValue('-webkit-box-sizing')\n    );\n\n    const paddingSize = (\n        parseFloat(style.getPropertyValue('padding-bottom')) +\n        parseFloat(style.getPropertyValue('padding-top'))\n    );\n\n    const borderSize = (\n        parseFloat(style.getPropertyValue('border-bottom-width')) +\n        parseFloat(style.getPropertyValue('border-top-width'))\n    );\n\n    const sizingStyle = SIZING_STYLE\n        .map(name => `${name}:${style.getPropertyValue(name)}`)\n        .join(';');\n\n    const nodeInfo = {\n        sizingStyle,\n        paddingSize,\n        borderSize,\n        boxSizing,\n    };\n\n    if (useCache && nodeRef) {\n        computedStyleCache[nodeRef] = nodeInfo;\n    }\n\n    return nodeInfo;\n}\n\nexport default function calculateNodeHeight(\n    uiTextNode,\n    useCache = false,\n    minRows,\n    maxRows,\n) {\n    if (!hiddenTextarea) {\n        hiddenTextarea = document.createElement('textarea');\n        document.body.appendChild(hiddenTextarea);\n    }\n\n    // Fix wrap=\"off\" issue\n    // https://github.com/ant-design/ant-design/issues/6577\n    if (uiTextNode.getAttribute('wrap')) {\n        hiddenTextarea.setAttribute('wrap', uiTextNode.getAttribute('wrap'));\n    } else {\n        hiddenTextarea.removeAttribute('wrap');\n    }\n\n    // Copy all CSS properties that have an impact on the height of the content in\n    // the textbox\n    const {\n        paddingSize, borderSize,\n        boxSizing, sizingStyle,\n    } = calculateNodeStyling(uiTextNode, useCache);\n\n    // Need to have the overflow attribute to hide the scrollbar otherwise\n    // text-lines will not calculated properly as the shadow will technically be\n    // narrower for content\n    hiddenTextarea.setAttribute('style', `${sizingStyle};${HIDDEN_TEXTAREA_STYLE}`);\n    hiddenTextarea.value = uiTextNode.value || uiTextNode.placeholder || '';\n\n    let minHeight = Number.MIN_SAFE_INTEGER;\n    let maxHeight = Number.MAX_SAFE_INTEGER;\n    let height = hiddenTextarea.scrollHeight;\n    let overflowY = {};\n\n    if (boxSizing === 'border-box') {\n        // border-box: add border, since height = content + padding + border\n        height += borderSize;\n    } else if (boxSizing === 'content-box') {\n        // remove padding, since height = content\n        height -= paddingSize;\n    }\n\n    if (minRows !== null || maxRows !== null) {\n        // measure height of a textarea with a single row\n        hiddenTextarea.value = ' ';\n        const singleRowHeight = hiddenTextarea.scrollHeight - paddingSize;\n        if (minRows !== null) {\n            minHeight = singleRowHeight * minRows;\n            if (boxSizing === 'border-box') {\n                minHeight = minHeight + paddingSize + borderSize;\n            }\n            height = Math.max(minHeight, height);\n        }\n        if (maxRows !== null) {\n            maxHeight = singleRowHeight * maxRows;\n            if (boxSizing === 'border-box') {\n                maxHeight = maxHeight + paddingSize + borderSize;\n            }\n            overflowY = height > maxHeight ? '' : 'hidden';\n            height = Math.min(maxHeight, height);\n        }\n    }\n    // Remove scroll bar flash when autosize without maxRows\n    if (!maxRows) {\n        overflowY = 'hidden';\n    }\n    return { height, minHeight, maxHeight, overflowY };\n}\n"]}