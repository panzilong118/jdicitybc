{"version":3,"sources":["../../components/anchor/Anchor.js"],"names":["React","ReactDOM","getDefaultContainer","window","getOffsetTop","element","container","getClientRects","length","rect","getBoundingClientRect","width","height","ownerDocument","documentElement","top","clientTop","easeInOutCubic","t","b","c","d","cc","reqAnimFrame","sharpMatcherRegx","scrollTo","href","offsetTop","getContainer","callback","scrollTop","sharpLinkMatch","exec","targetElement","document","getElementById","eleOffsetTop","targetScrollTop","startTime","Date","now","frameFunc","timestamp","time","nextScrollTop","pageXOffset","history","pushState","Anchor","props","handleScroll","animating","bounds","setState","activeLink","getCurrentAnchor","handleScrollTo","link","updateInk","prefixCls","anchorNode","findDOMNode","linkNode","getElementsByClassName","inkNode","style","clientHeight","saveInkNode","node","state","links","scrollEvent","jcAnchor","registerLink","includes","push","unregisterLink","index","indexOf","splice","remove","linkSections","forEach","toString","target","maxSection","reduce","prev","curr","className","affix","showInkInFixed","children","inkClass","visible","wrapperClass","anchorClass","wrapperStyle","maxHeight","anchorContent","Component","defaultProps","childContextTypes","object"],"mappings":"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","file":"Anchor.js","sourcesContent":["import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport addEventListener from 'rc-util/lib/Dom/addEventListener';\nimport Affix from '../affix';\nimport AnchorLink from './AnchorLink';\nimport getScroll from '../_util/getScroll';\nimport getRequestAnimationFrame from '../_util/getRequestAnimationFrame';\n\nfunction getDefaultContainer() {\n  return window;\n}\n\nfunction getOffsetTop(element, container) {\n  if (!element) {\n    return 0;\n  }\n\n  if (!element.getClientRects().length) {\n    return 0;\n  }\n\n  const rect = element.getBoundingClientRect();\n\n  if (rect.width || rect.height) {\n    if (container === window) {\n      container = element.ownerDocument.documentElement;\n      return rect.top - container.clientTop;\n    }\n    return rect.top - container.getBoundingClientRect().top;\n  }\n\n  return rect.top;\n}\n\nfunction easeInOutCubic(t, b, c, d) {\n  const cc = c - b;\n  t /= d / 2;\n  if (t < 1) {\n    return cc / 2 * t * t * t + b;\n  }\n  return cc / 2 * ((t -= 2) * t * t + 2) + b;\n}\n\nconst reqAnimFrame = getRequestAnimationFrame();\nconst sharpMatcherRegx = /#([^#]+)$/;\nfunction scrollTo(href, offsetTop = 0, getContainer, callback = () => { }) {\n  const container = getContainer();\n  const scrollTop = getScroll(container, true);\n  const sharpLinkMatch = sharpMatcherRegx.exec(href);\n  if (!sharpLinkMatch) { return; }\n  const targetElement = document.getElementById(sharpLinkMatch[1]);\n  if (!targetElement) {\n    return;\n  }\n  const eleOffsetTop = getOffsetTop(targetElement, container);\n  const targetScrollTop = scrollTop + eleOffsetTop - offsetTop;\n  const startTime = Date.now();\n  const frameFunc = () => {\n    const timestamp = Date.now();\n    const time = timestamp - startTime;\n    const nextScrollTop = easeInOutCubic(time, scrollTop, targetScrollTop, 450);\n    if (container === window) {\n      window.scrollTo(window.pageXOffset, nextScrollTop);\n    } else {\n      container.scrollTop = nextScrollTop;\n    }\n    if (time < 450) {\n      reqAnimFrame(frameFunc);\n    } else {\n      callback();\n    }\n  };\n  reqAnimFrame(frameFunc);\n  history.pushState(null, '', href);\n}\n\nexport default class Anchor extends React.Component {\n  // static Link: typeof AnchorLink;\n\n  static defaultProps = {\n    prefixCls: 'jc-anchor',\n    affix: true,\n    showInkInFixed: false,\n    getContainer: getDefaultContainer,\n  };\n\n  static childContextTypes = {\n    jcAnchor: PropTypes.object,\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      activeLink: null,\n    };\n    this.links = [];\n    this.inkNode = {};\n    this.scrollEvent = {};\n    this.animating = false;\n  }\n\n  getChildContext() {\n    return {\n      jcAnchor: {\n        registerLink: (link) => {\n          if (!this.links.includes(link)) {\n            this.links.push(link);\n          }\n        },\n        unregisterLink: (link) => {\n          const index = this.links.indexOf(link);\n          if (index !== -1) {\n            this.links.splice(index, 1);\n          }\n        },\n        activeLink: this.state.activeLink,\n        scrollTo: this.handleScrollTo,\n      },\n    };\n  }\n\n  componentDidMount() {\n    const { getContainer } = this.props;\n    this.scrollEvent = addEventListener(getContainer(), 'scroll', this.handleScroll);\n    this.handleScroll();\n  }\n\n  componentWillUnmount() {\n    if (this.scrollEvent) {\n      this.scrollEvent.remove();\n    }\n  }\n\n  componentDidUpdate() {\n    this.updateInk();\n  }\n\n  handleScroll = () => {\n    if (this.animating) {\n      return;\n    }\n    const { offsetTop, bounds } = this.props;\n    this.setState({\n      activeLink: this.getCurrentAnchor(offsetTop, bounds),\n    });\n  }\n\n  handleScrollTo = (link) => {\n    const { offsetTop, getContainer } = this.props;\n    this.animating = true;\n    this.setState({ activeLink: link });\n    scrollTo(link, offsetTop, getContainer, () => {\n      this.animating = false;\n    });\n  }\n\n  getCurrentAnchor(offsetTop = 0, bounds = 5) {\n    let activeLink = '';\n    if (typeof document === 'undefined') {\n      return activeLink;\n    }\n\n    const linkSections = [];\n    const { getContainer } = this.props;\n    const container = getContainer();\n    this.links.forEach(link => {\n      const sharpLinkMatch = sharpMatcherRegx.exec(link.toString());\n      if (!sharpLinkMatch) { return; }\n      const target = document.getElementById(sharpLinkMatch[1]);\n      if (target) {\n        const top = getOffsetTop(target, container);\n        if (top < offsetTop + bounds) {\n          linkSections.push({\n            link,\n            top,\n          });\n        }\n      }\n    });\n\n    if (linkSections.length) {\n      const maxSection = linkSections.reduce((prev, curr) => curr.top > prev.top ? curr : prev);\n      return maxSection.link;\n    }\n    return '';\n  }\n\n  updateInk = () => {\n    if (typeof document === 'undefined') {\n      return;\n    }\n    const { prefixCls } = this.props;\n    const anchorNode = ReactDOM.findDOMNode(this);\n    const linkNode = anchorNode.getElementsByClassName(`${prefixCls}-link-title-active`)[0];\n    if (linkNode) {\n      this.inkNode.style.top = `${linkNode.offsetTop + linkNode.clientHeight / 2 - 4.5}px`;\n    }\n  }\n\n  saveInkNode = (node) => {\n    this.inkNode = node;\n  }\n\n  render() {\n    const {\n      prefixCls,\n      className = '',\n      style,\n      offsetTop,\n      affix,\n      showInkInFixed,\n      children,\n    } = this.props;\n    const { activeLink } = this.state;\n\n    const inkClass = classNames(`${prefixCls}-ink-ball`, {\n      visible: activeLink,\n    });\n\n    const wrapperClass = classNames(className, `${prefixCls}-wrapper`);\n\n    const anchorClass = classNames(prefixCls, {\n      'fixed': !affix && !showInkInFixed,\n    });\n\n    const wrapperStyle = {\n      maxHeight: offsetTop ? `calc(100vh - ${offsetTop}px)` : '100vh',\n      ...style,\n    };\n\n    const anchorContent = (\n      <div\n        className={wrapperClass}\n        style={wrapperStyle}\n      >\n        <div className={anchorClass}>\n          <div className={`${prefixCls}-ink`} >\n            <span className={inkClass} ref={this.saveInkNode} />\n          </div>\n          {children}\n        </div>\n      </div>\n    );\n\n    return !affix ? anchorContent : (\n      <Affix offsetTop={offsetTop}>\n        {anchorContent}\n      </Affix>\n    );\n  }\n}\n"]}