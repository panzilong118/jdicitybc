{"version":3,"sources":["../../components/anchor/Anchor.js"],"names":["React","ReactDOM","getDefaultContainer","window","getOffsetTop","element","container","getClientRects","length","rect","getBoundingClientRect","width","height","ownerDocument","documentElement","top","clientTop","easeInOutCubic","t","b","c","d","cc","reqAnimFrame","sharpMatcherRegx","scrollTo","href","offsetTop","getContainer","callback","scrollTop","sharpLinkMatch","exec","targetElement","document","getElementById","eleOffsetTop","targetScrollTop","startTime","Date","now","frameFunc","timestamp","time","nextScrollTop","pageXOffset","history","pushState","Anchor","props","handleScroll","animating","bounds","setState","activeLink","getCurrentAnchor","handleScrollTo","link","updateInk","prefixCls","anchorNode","findDOMNode","linkNode","getElementsByClassName","inkNode","style","clientHeight","saveInkNode","node","state","links","scrollEvent","jcAnchor","registerLink","includes","push","unregisterLink","index","indexOf","splice","remove","linkSections","forEach","toString","target","maxSection","reduce","prev","curr","className","affix","showInkInFixed","children","inkClass","visible","wrapperClass","anchorClass","wrapperStyle","maxHeight","anchorContent","Component","defaultProps","childContextTypes","object"],"mappings":"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","file":"Anchor.js","sourcesContent":["import * as React from 'react';\r\nimport * as ReactDOM from 'react-dom';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport addEventListener from 'rc-util/lib/Dom/addEventListener';\r\nimport Affix from '../affix';\r\nimport AnchorLink from './AnchorLink';\r\nimport getScroll from '../_util/getScroll';\r\nimport getRequestAnimationFrame from '../_util/getRequestAnimationFrame';\r\n\r\nfunction getDefaultContainer() {\r\n  return window;\r\n}\r\n\r\nfunction getOffsetTop(element, container) {\r\n  if (!element) {\r\n    return 0;\r\n  }\r\n\r\n  if (!element.getClientRects().length) {\r\n    return 0;\r\n  }\r\n\r\n  const rect = element.getBoundingClientRect();\r\n\r\n  if (rect.width || rect.height) {\r\n    if (container === window) {\r\n      container = element.ownerDocument.documentElement;\r\n      return rect.top - container.clientTop;\r\n    }\r\n    return rect.top - container.getBoundingClientRect().top;\r\n  }\r\n\r\n  return rect.top;\r\n}\r\n\r\nfunction easeInOutCubic(t, b, c, d) {\r\n  const cc = c - b;\r\n  t /= d / 2;\r\n  if (t < 1) {\r\n    return cc / 2 * t * t * t + b;\r\n  }\r\n  return cc / 2 * ((t -= 2) * t * t + 2) + b;\r\n}\r\n\r\nconst reqAnimFrame = getRequestAnimationFrame();\r\nconst sharpMatcherRegx = /#([^#]+)$/;\r\nfunction scrollTo(href, offsetTop = 0, getContainer, callback = () => { }) {\r\n  const container = getContainer();\r\n  const scrollTop = getScroll(container, true);\r\n  const sharpLinkMatch = sharpMatcherRegx.exec(href);\r\n  if (!sharpLinkMatch) { return; }\r\n  const targetElement = document.getElementById(sharpLinkMatch[1]);\r\n  if (!targetElement) {\r\n    return;\r\n  }\r\n  const eleOffsetTop = getOffsetTop(targetElement, container);\r\n  const targetScrollTop = scrollTop + eleOffsetTop - offsetTop;\r\n  const startTime = Date.now();\r\n  const frameFunc = () => {\r\n    const timestamp = Date.now();\r\n    const time = timestamp - startTime;\r\n    const nextScrollTop = easeInOutCubic(time, scrollTop, targetScrollTop, 450);\r\n    if (container === window) {\r\n      window.scrollTo(window.pageXOffset, nextScrollTop);\r\n    } else {\r\n      container.scrollTop = nextScrollTop;\r\n    }\r\n    if (time < 450) {\r\n      reqAnimFrame(frameFunc);\r\n    } else {\r\n      callback();\r\n    }\r\n  };\r\n  reqAnimFrame(frameFunc);\r\n  history.pushState(null, '', href);\r\n}\r\n\r\nexport default class Anchor extends React.Component {\r\n  // static Link: typeof AnchorLink;\r\n\r\n  static defaultProps = {\r\n    prefixCls: 'jc-anchor',\r\n    affix: true,\r\n    showInkInFixed: false,\r\n    getContainer: getDefaultContainer,\r\n  };\r\n\r\n  static childContextTypes = {\r\n    jcAnchor: PropTypes.object,\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      activeLink: null,\r\n    };\r\n    this.links = [];\r\n    this.inkNode = {};\r\n    this.scrollEvent = {};\r\n    this.animating = false;\r\n  }\r\n\r\n  getChildContext() {\r\n    return {\r\n      jcAnchor: {\r\n        registerLink: (link) => {\r\n          if (!this.links.includes(link)) {\r\n            this.links.push(link);\r\n          }\r\n        },\r\n        unregisterLink: (link) => {\r\n          const index = this.links.indexOf(link);\r\n          if (index !== -1) {\r\n            this.links.splice(index, 1);\r\n          }\r\n        },\r\n        activeLink: this.state.activeLink,\r\n        scrollTo: this.handleScrollTo,\r\n      },\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { getContainer } = this.props;\r\n    this.scrollEvent = addEventListener(getContainer(), 'scroll', this.handleScroll);\r\n    this.handleScroll();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.scrollEvent) {\r\n      this.scrollEvent.remove();\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.updateInk();\r\n  }\r\n\r\n  handleScroll = () => {\r\n    if (this.animating) {\r\n      return;\r\n    }\r\n    const { offsetTop, bounds } = this.props;\r\n    this.setState({\r\n      activeLink: this.getCurrentAnchor(offsetTop, bounds),\r\n    });\r\n  }\r\n\r\n  handleScrollTo = (link) => {\r\n    const { offsetTop, getContainer } = this.props;\r\n    this.animating = true;\r\n    this.setState({ activeLink: link });\r\n    scrollTo(link, offsetTop, getContainer, () => {\r\n      this.animating = false;\r\n    });\r\n  }\r\n\r\n  getCurrentAnchor(offsetTop = 0, bounds = 5) {\r\n    let activeLink = '';\r\n    if (typeof document === 'undefined') {\r\n      return activeLink;\r\n    }\r\n\r\n    const linkSections = [];\r\n    const { getContainer } = this.props;\r\n    const container = getContainer();\r\n    this.links.forEach(link => {\r\n      const sharpLinkMatch = sharpMatcherRegx.exec(link.toString());\r\n      if (!sharpLinkMatch) { return; }\r\n      const target = document.getElementById(sharpLinkMatch[1]);\r\n      if (target) {\r\n        const top = getOffsetTop(target, container);\r\n        if (top < offsetTop + bounds) {\r\n          linkSections.push({\r\n            link,\r\n            top,\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    if (linkSections.length) {\r\n      const maxSection = linkSections.reduce((prev, curr) => curr.top > prev.top ? curr : prev);\r\n      return maxSection.link;\r\n    }\r\n    return '';\r\n  }\r\n\r\n  updateInk = () => {\r\n    if (typeof document === 'undefined') {\r\n      return;\r\n    }\r\n    const { prefixCls } = this.props;\r\n    const anchorNode = ReactDOM.findDOMNode(this);\r\n    const linkNode = anchorNode.getElementsByClassName(`${prefixCls}-link-title-active`)[0];\r\n    if (linkNode) {\r\n      this.inkNode.style.top = `${linkNode.offsetTop + linkNode.clientHeight / 2 - 4.5}px`;\r\n    }\r\n  }\r\n\r\n  saveInkNode = (node) => {\r\n    this.inkNode = node;\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      prefixCls,\r\n      className = '',\r\n      style,\r\n      offsetTop,\r\n      affix,\r\n      showInkInFixed,\r\n      children,\r\n    } = this.props;\r\n    const { activeLink } = this.state;\r\n\r\n    const inkClass = classNames(`${prefixCls}-ink-ball`, {\r\n      visible: activeLink,\r\n    });\r\n\r\n    const wrapperClass = classNames(className, `${prefixCls}-wrapper`);\r\n\r\n    const anchorClass = classNames(prefixCls, {\r\n      'fixed': !affix && !showInkInFixed,\r\n    });\r\n\r\n    const wrapperStyle = {\r\n      maxHeight: offsetTop ? `calc(100vh - ${offsetTop}px)` : '100vh',\r\n      ...style,\r\n    };\r\n\r\n    const anchorContent = (\r\n      <div\r\n        className={wrapperClass}\r\n        style={wrapperStyle}\r\n      >\r\n        <div className={anchorClass}>\r\n          <div className={`${prefixCls}-ink`} >\r\n            <span className={inkClass} ref={this.saveInkNode} />\r\n          </div>\r\n          {children}\r\n        </div>\r\n      </div>\r\n    );\r\n\r\n    return !affix ? anchorContent : (\r\n      <Affix offsetTop={offsetTop}>\r\n        {anchorContent}\r\n      </Affix>\r\n    );\r\n  }\r\n}\r\n"]}