{"version":3,"sources":["../../components/table/filterDropdown.js"],"names":["React","ReactDOM","FilterMenu","props","visible","column","filterDropdownVisible","state","selectedKeys","keyPathOfSelectedItem","neverShown","setNeverShown","nextProps","newState","Object","keys","length","setState","onFilterDropdownVisibleChange","confirmFilter","item","multiple","filterMultiple","input","indexOf","value","toString","text","filters","some","children","items","map","containSelected","key","subMenuCls","dropdownPrefixCls","renderMenus","renderMenuItem","locale","prefixCls","getPopupContainer","dropdownMenuClass","hasSubMenu","menus","filterDropdown","handleMenuItemClick","setSelectedKeys","triggerNode","parentNode","handleConfirm","filterConfirm","handleClearFilters","filterReset","onVisibleChange","renderFilterIcon","Component","propTypes","defaultProps","handleFilter","rootNode","findDOMNode","filterBelongToScrollBody","fixed","setVisible","info","keyPath","filterIcon","dropdownSelectedClass","cloneElement","title","filterTitle","className"],"mappings":"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","file":"filterDropdown.js","sourcesContent":["import * as React from 'react';\n\nimport * as ReactDOM from 'react-dom';\n\nimport PropTypes from 'prop-types';\n\nimport Menu, { SubMenu, Item as MenuItem } from 'rc-menu';\n\nimport closest from 'dom-closest';\n\nimport classNames from 'classnames';\n\nimport Dropdown from '../dropdown';\n\nimport Icon from '../icon';\n\nimport Checkbox from '../checkbox';\n\nimport Radio from '../radio';\n\nimport FilterDropdownMenuWrapper from './FilterDropdownMenuWrapper';\n\nimport { FilterMenuProps } from './interface';\n\nexport default class FilterMenu extends React.Component {\n    static propTypes = {...FilterMenuProps};\n\n    static defaultProps = {\n        handleFilter: () => {},\n        column: {}\n    };\n\n    constructor(props) {\n        super(props);\n\n        const visible = ('filterDropdownVisible' in props.column) ? props.column.filterDropdownVisible : false;\n\n        \n        this.state = {\n            selectedKeys: props.selectedKeys,\n            keyPathOfSelectedItem: {},    // 记录所有有选中子菜单的祖先菜单\n            visible,\n        };\n\n        this.neverShown = false;\n    }\n\n    componentDidMount() {\n        const { column } = this.props;\n        this.setNeverShown(column);\n    }\n\n    componentWillReceiveProps(nextProps) {\n        const { column } = nextProps;\n        this.setNeverShown(column);\n        const newState = {\n            selectedKeys: [],\n            visible: false\n        };\n        if ('selectedKeys' in nextProps) {\n            newState.selectedKeys = nextProps.selectedKeys;\n        }\n        if ('filterDropdownVisible' in column) {\n            newState.visible = column.filterDropdownVisible;\n        }\n        if (Object.keys(newState).length > 0) {\n            this.setState(newState);\n        }\n    }\n\n    setNeverShown = (column) => {\n        const rootNode = ReactDOM.findDOMNode(this);\n        const filterBelongToScrollBody = !!closest(rootNode, `.jc-table-scroll`);\n        if (filterBelongToScrollBody) {\n            // When fixed column have filters, there will be two dropdown menus\n            // Filter dropdown menu inside scroll body should never be shown\n            // To fix https://github.com/ant-design/ant-design/issues/5010 and\n            // https://github.com/ant-design/ant-design/issues/7909\n            this.neverShown = !!column.fixed;\n        }\n    }\n\n    setSelectedKeys = ({ selectedKeys }) => {\n        this.setState({ selectedKeys });\n    }\n\n    setVisible(visible) {\n        const { column } = this.props;\n        if (!('filterDropdownVisible' in column)) {\n            this.setState({ visible });\n        }\n        if (column.onFilterDropdownVisibleChange) {\n            column.onFilterDropdownVisibleChange(visible);\n        }\n    }\n\n    handleClearFilters = () => {\n        this.setState({\n            selectedKeys: []\n        }, this.handleConfirm);\n    }\n\n    handleConfirm = () => {\n        this.setVisible(false);\n        this.confirmFilter();\n    }\n\n    onVisibleChange = (visible) => {\n        this.setVisible(visible);\n        if (!visible) {\n            this.confirmFilter();\n        }\n    }\n\n    confirmFilter() {\n        if (this.state.selectedKeys !== this.props.selectedKeys) {\n            this.props.confirmFilter(this.props.column, this.state.selectedKeys);\n        }\n    }\n\n    renderMenuItem(item) {\n        const { column } = this.props;\n        const multiple = ('filterMultiple' in column) ? column.filterMultiple : true;\n        const input = multiple ? (\n            <Checkbox checked={this.state.selectedKeys.indexOf(item.value.toString()) >= 0} />\n        ) : (\n            <Radio checked={this.state.selectedKeys.indexOf(item.value.toString()) >= 0} />\n        );\n\n        return (\n            <MenuItem key={item.value}>\n                {input}\n                <span>{item.text}</span>\n            </MenuItem>\n        );\n    }\n\n    hasSubMenu() {\n        const { column: { filters = [] } } = this.props;\n        return filters.some(item => !!(item.children && item.children.length > 0));\n    }\n\n    renderMenus(items) {\n        return items.map(item => {\n            if (item.children && item.children.length > 0) {\n                const { keyPathOfSelectedItem } = this.state;\n                const containSelected = Object.keys(keyPathOfSelectedItem).some(\n                    key => keyPathOfSelectedItem[key].indexOf(item.value) >= 0,\n                );\n                const subMenuCls = containSelected ? `${this.props.dropdownPrefixCls}-submenu-contain-selected` : '';\n                return (\n                    <SubMenu title={item.text} className={subMenuCls} key={item.value.toString()}>\n                        {this.renderMenus(item.children)}\n                    </SubMenu>\n                );\n            }\n            return this.renderMenuItem(item);\n        });\n    }\n\n    handleMenuItemClick = (info = { keyPath: '', key: '' }) => {\n        if (info.keyPath.length <= 1) {\n            return;\n        }\n        const keyPathOfSelectedItem = this.state.keyPathOfSelectedItem;\n        if (this.state.selectedKeys.indexOf(info.key) >= 0) {\n            // deselect SubMenu child\n            delete keyPathOfSelectedItem[info.key];\n        } else {\n            // select SubMenu child\n            keyPathOfSelectedItem[info.key] = info.keyPath;\n        }\n        this.setState({ keyPathOfSelectedItem });\n    }\n\n    renderFilterIcon = () => {\n        const { column, locale, prefixCls } = this.props;\n        const filterIcon = column.filterIcon;\n        const dropdownSelectedClass = this.props.selectedKeys.length > 0 ? `${prefixCls}-selected` : '';\n\n        return filterIcon ? React.cloneElement(filterIcon, {\n            title: locale.filterTitle,\n            className: classNames(filterIcon.className, {\n                [`${prefixCls}-icon`]: true\n            }),\n        }) : <Icon title={locale.filterTitle} type=\"filter\" className={dropdownSelectedClass} />;\n    }\n    render() {\n        const { column, locale, prefixCls, dropdownPrefixCls, getPopupContainer } = this.props;\n        // default multiple selection in filter dropdown\n        const multiple = ('filterMultiple' in column) ? column.filterMultiple : true;\n        const dropdownMenuClass = classNames({\n            [`${dropdownPrefixCls}-menu-without-submenu`]: !this.hasSubMenu()\n        });\n        const menus = column.filterDropdown ? (\n            <FilterDropdownMenuWrapper>\n                {column.filterDropdown}\n            </FilterDropdownMenuWrapper>\n        ) : (\n            <FilterDropdownMenuWrapper className={`${prefixCls}-dropdown`}>\n                <Menu\n                    multiple={multiple}\n                    onClick={this.handleMenuItemClick}\n                    prefixCls={`${dropdownPrefixCls}-menu`}\n                    className={dropdownMenuClass}\n                    onSelect={this.setSelectedKeys}\n                    onDeselect={this.setSelectedKeys}\n                    selectedKeys={this.state.selectedKeys}\n                    getPopupContainer={(triggerNode) => triggerNode.parentNode}\n                >\n                    {this.renderMenus(column.filters)}\n                </Menu>\n                <div className={`${prefixCls}-dropdown-btns`}>\n                    <a\n                        className={`${prefixCls}-dropdown-link confirm`}\n                        onClick={this.handleConfirm}\n                    >\n                        {locale.filterConfirm}\n                    </a>\n                    <a\n                        className={`${prefixCls}-dropdown-link clear`}\n                        onClick={this.handleClearFilters}\n                    >\n                        {locale.filterReset}\n                    </a>\n                </div>\n            </FilterDropdownMenuWrapper>\n        );\n\n        return (\n            <Dropdown\n                trigger={['click']}\n                overlay={menus}\n                visible={this.neverShown ? false : this.state.visible}\n                onVisibleChange={this.onVisibleChange}\n                getPopupContainer={getPopupContainer}\n                forceRender\n            >\n                {this.renderFilterIcon()}\n            </Dropdown>\n        );\n    }\n}\n"]}