{"version":3,"sources":["../../components/avatar/index.js"],"names":["React","ReactDOM","Avatar","props","setScale","childrenNode","avatarChildren","childrenWidth","offsetWidth","avatarWidth","findDOMNode","getBoundingClientRect","width","setState","scale","handleImgLoadError","isImgExist","state","undefined","prevProps","prevState","children","prefixCls","shape","size","src","icon","className","others","sizeCls","classString","childrenStyle","msTransform","WebkitTransform","transform","position","display","left","Math","round","span","Component","defaultProps"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Created by gaoqingli on 2018/4/13.\n */\nimport * as React from 'react';\n\nimport * as ReactDOM from 'react-dom';\n\nimport classNames from 'classnames';\n\nimport Icon from '../icon';\n\nexport default class Avatar extends React.Component {\n  static defaultProps = {\n      prefixCls: 'jc-avatar',\n      shape: 'circle',\n      size: 'default',\n  };\n\n  // static avatarChildren;\n\n  constructor(props) {\n      super(props);\n      this.state = {\n          scale: 1,\n          isImgExist: true,\n      };\n      this.avatarChildren = undefined;\n  }\n\n  componentDidMount() {\n      this.setScale();\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n      if (prevProps.children !== this.props.children\n        || (prevState.scale !== this.state.scale && this.state.scale === 1)) {\n          this.setScale();\n      }\n  }\n\n  setScale = () => {\n      const childrenNode = this.avatarChildren;\n      if (childrenNode) {\n          const childrenWidth = childrenNode.offsetWidth;\n          const avatarWidth = ReactDOM.findDOMNode(this).getBoundingClientRect().width;\n          // add 4px gap for each side to get better performance\n          if (avatarWidth - 8 < childrenWidth) {\n              this.setState({\n                  scale: (avatarWidth - 8) / childrenWidth,\n              });\n          } else {\n              this.setState({\n                  scale: 1,\n              });\n          }\n      }\n  }\n\n  handleImgLoadError = () => this.setState({ isImgExist: false });\n\n  render() {\n      const {\n          prefixCls, shape, size, src, icon, className, ...others\n      } = this.props;\n\n      const sizeCls = classNames({\n          [`${prefixCls}-lg`]: size === 'large',\n          [`${prefixCls}-sm`]: size === 'small',\n      });\n\n      const classString = classNames(prefixCls, className, sizeCls, {\n          [`${prefixCls}-${shape}`]: shape,\n          [`${prefixCls}-image`]: src && this.state.isImgExist,\n          [`${prefixCls}-icon`]: icon,\n      });\n\n      let { children } = this.props;\n      if (src && this.state.isImgExist) {\n          children = (\n              <img\n                  alt=''\n                  src={src}\n                  onError={this.handleImgLoadError}\n              />\n          );\n      } else if (icon) {\n          children = <Icon type={icon} />;\n      } else {\n          const childrenNode = this.avatarChildren;\n          if (childrenNode || this.state.scale !== 1) {\n              const childrenStyle: React.CSSProperties = {\n                  msTransform: `scale(${this.state.scale})`,\n                  WebkitTransform: `scale(${this.state.scale})`,\n                  transform: `scale(${this.state.scale})`,\n                  position: 'absolute',\n                  display: 'inline-block',\n                  left: `calc(50% - ${Math.round(childrenNode.offsetWidth / 2)}px)`,\n              };\n              children = (\n                  <span\n                      className={`${prefixCls}-string`}\n                      ref={(span) => { this.avatarChildren = span; }}\n                      style={childrenStyle}\n                  >\n                      {children}\n                  </span>\n              );\n          } else {\n              children = (\n                  <span\n                      className={`${prefixCls}-string`}\n                      ref={(span) => { this.avatarChildren = span; }}\n                  >\n                      {children}\n                  </span>\n              );\n          }\n      }\n      return (\n          <span {...others} className={classString}>\n              {children}\n          </span>\n      );\n  }\n}\n"]}